<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>관리자 페이지 - 회원 목록</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-10">
    <div class="max-w-4xl mx-auto bg-white p-8 rounded-lg shadow">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold">회원 관리 (Admin)</h1>
            <button onclick="adminLogout()" class="bg-red-500 text-white px-4 py-2 rounded font-bold hover:bg-red-600">로그아웃</button>
        </div>
        <table class="w-full text-left border-collapse">
            <thead>
                <tr class="bg-gray-100 border-b">
                    <th class="p-3">아이디</th>
                    <th class="p-3">이름</th>
                    <th class="p-3">전화번호</th>
                    <th class="p-3">가입 경로</th>
                    <th class="p-3">가입일</th>
                </tr>
            </thead>
            <tbody id="user-list"></tbody>
        </table>
    </div>
    <script>
        // 관리자 권한 체크 및 안전한 리다이렉트
        const currentUserId = localStorage.getItem('userId');
        if(currentUserId !== 'admin') {
            alert("관리자만 접근 가능합니다.");
            try {
                window.location.href = 'index.html';
            } catch (e) {
                console.log("Redirect blocked in preview, showing link.");
                document.body.innerHTML = "<div style='text-align:center; padding:50px;'><h1>접근 권한이 없습니다.</h1><a href='index.html' style='color:blue; text-decoration:underline;'>메인 페이지로 돌아가기</a></div>";
            }
        }

        const tbody = document.getElementById('user-list');
        let count = 0;
        for(let i=0; i<localStorage.length; i++) {
            const key = localStorage.key(i);
            if(key.startsWith('user_')) {
                count++;
                const user = JSON.parse(localStorage.getItem(key));
                const row = `<tr class="border-b hover:bg-gray-50">
                    <td class="p-3 text-indigo-600 font-bold">${user.id}</td>
                    <td class="p-3 font-bold">${user.name}</td>
                    <td class="p-3">${user.phone || '-'}</td>
                    <td class="p-3 text-sm">${user.source || '-'}</td>
                    <td class="p-3 text-sm text-gray-500">${user.date ? user.date.split('T')[0] : '-'}</td>
                </tr>`;
                tbody.innerHTML += row;
            }
        }
        if(count === 0) tbody.innerHTML = '<tr><td colspan="5" class="p-8 text-center text-gray-500">가입된 회원이 없습니다.</td></tr>';

        function adminLogout() {
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('userId');
            localStorage.removeItem('userName');
            try {
                window.location.href = 'index.html';
            } catch (e) {
                alert("로그아웃 되었습니다. 메인으로 이동해주세요.");
            }
        }
    </script>
</body>
</html>