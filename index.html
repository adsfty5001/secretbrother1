<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 중요: 모든 HTTP 요청을 HTTPS로 자동 업그레이드하여 혼합 콘텐츠 차단 방지 -->
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"> 
    <title>시크릿클래스 - 대한민국 1호 아파트 큐레이터</title>
    
    <!-- Tailwind CSS (HTTPS) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons (HTTPS) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* 폰트 설정 (HTTPS) */
        @font-face {
            font-family: 'Jalnan';
            src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonnu-fonts_two@1.0/Jalnan.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700&display=swap');

        /* 기본 스타일 */
        :root { --primary: #4f46e5; --primary-dark: #4338ca; }
        * { font-family: 'Jalnan', sans-serif; }
        body { font-family: 'Pretendard', sans-serif; letter-spacing: -0.02em; overflow-x: hidden; }
        
        /* 유틸리티 클래스 */
        .font-jalnan { font-family: 'Jalnan', sans-serif !important; }
        .font-body { font-family: 'Pretendard', sans-serif !important; }
        .break-keep { word-break: keep-all; word-wrap: break-word; }
        
        /* 스크롤바 커스텀 */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* 애니메이션 */
        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fade-in 0.5s ease-out forwards; }
        
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
        .animate-float { animation: float 6s ease-in-out infinite; }

        /* 화면 전환 유틸리티 */
        .hidden-section { display: none !important; }
        .hidden { display: none !important; }
        
        /* 후기 카드 텍스트 줄임 (일정 높이 유지) */
        .line-clamp-custom {
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
            overflow: hidden;
            height: 6rem; /* 높이 고정으로 카드 크기 일정하게 유지 */
        }

        /* 원본 스타일 유지 (모달용) */
        .raw-content {
            line-height: 1.7;
            white-space: pre-wrap; /* 줄바꿈 보존 */
            color: #374151;
        }
        
        /* HTML 엔티티 디코딩용 */
        .decoded-content p { margin-bottom: 1em; }
    </style>
</head>
<body class="bg-white text-gray-900 font-body flex flex-col min-h-screen">

    <!-- 1. 최상단 배너 -->
    <div class="bg-red-600 text-white text-center py-3 text-sm md:text-base shadow-md z-50 relative break-keep px-4">
        <div class="animate-pulse flex justify-center items-center gap-2">
            <span class="font-bold bg-white text-red-600 px-2 py-0.5 rounded text-xs">마감임박</span>
            <span>이번 달 큐레이팅 마감까지 <span id="countdown-number" class="text-yellow-300 font-extrabold text-lg">2</span>자리 남았습니다.</span>
        </div>
    </div>

    <!-- 2. 헤더 -->
    <header class="sticky top-0 z-40 bg-white/95 backdrop-blur-md border-b border-gray-100 transition-all duration-300">
        <!-- 로그인 상태 바 -->
        <div class="bg-gray-50 border-b border-gray-100">
            <div class="max-w-7xl mx-auto px-4 py-2 flex justify-end items-center gap-4 text-xs text-gray-500">
                <div id="auth-guest" class="flex items-center gap-3">
                    <button onclick="window.App.openModal('loginModal', 'login')" class="hover:text-indigo-600 transition-colors">로그인</button>
                    <span class="w-px h-3 bg-gray-300"></span>
                    <button onclick="window.App.openModal('loginModal', 'signup')" class="hover:text-indigo-600 transition-colors">회원가입</button>
                </div>
                <div id="auth-user" class="hidden-section flex items-center gap-3">
                    <!-- 관리자 버튼 (관리자일 때만 보임) -->
                    <button id="btn-admin-open" onclick="window.App.openAdminModal()" class="hidden bg-gray-800 text-white px-2 py-1 rounded hover:bg-gray-700 transition-colors mr-2">
                        <i data-lucide="settings" class="w-3 h-3 inline"></i> 관리자
                    </button>
                    <span class="font-bold text-gray-700"><span id="user-name-display" class="text-indigo-600"></span>님</span>
                    <span class="w-px h-3 bg-gray-300"></span>
                    <button onclick="window.App.logout()" class="hover:text-red-500 transition-colors">로그아웃</button>
                </div>
                <span class="w-px h-3 bg-gray-300"></span>
                <button onclick="window.App.openMypage()" class="font-bold text-indigo-600 hover:text-indigo-800 transition-colors flex items-center gap-1">
                    <i data-lucide="user" class="w-3 h-3"></i> 나의강의실
                </button>
            </div>
        </div>

        <!-- 네비게이션 -->
        <div class="max-w-7xl mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex justify-between items-center w-full md:w-auto">
                <a href="javascript:void(0)" onclick="window.App.navigate('home')" class="text-left group cursor-pointer">
                    <div class="text-2xl font-jalnan font-bold text-indigo-900 tracking-tighter group-hover:text-indigo-700 transition-colors">시크릿클래스</div>
                    <div class="text-[10px] text-indigo-400 tracking-[0.3em] font-light">SECRETCLASS</div>
                </a>
                <button class="md:hidden p-2" onclick="window.App.toggleMobileMenu()">
                    <i data-lucide="menu" class="h-6 w-6 text-gray-800"></i>
                </button>
            </div>
            
            <!-- 메뉴 -->
            <nav class="hidden md:flex gap-8 font-medium text-gray-600">
                <button onclick="window.App.scrollToSection('about')" class="hover:text-indigo-600 transition-colors py-2">소개</button>
                <button onclick="window.App.scrollToSection('curriculum')" class="hover:text-indigo-600 transition-colors py-2">진행과정</button>
                <button onclick="window.App.scrollToSection('pricing')" class="hover:text-indigo-600 transition-colors py-2">수강신청</button>
                <button onclick="window.App.scrollToSection('reviews')" class="hover:text-indigo-600 transition-colors py-2">강의후기</button>
                <button onclick="window.App.scrollToSection('faq')" class="hover:text-indigo-600 transition-colors py-2">고객센터</button>
            </nav>
        </div>

        <!-- 모바일 메뉴 -->
        <div id="mobileMenu" class="hidden md:hidden bg-white border-t border-gray-100 absolute w-full left-0 shadow-lg animate-fade-in">
            <div class="flex flex-col text-gray-700">
                <button onclick="window.App.scrollToSection('about'); window.App.toggleMobileMenu()" class="text-left py-4 px-6 border-b border-gray-50 hover:bg-gray-50">소개</button>
                <button onclick="window.App.scrollToSection('curriculum'); window.App.toggleMobileMenu()" class="text-left py-4 px-6 border-b border-gray-50 hover:bg-gray-50">진행과정</button>
                <button onclick="window.App.scrollToSection('pricing'); window.App.toggleMobileMenu()" class="text-left py-4 px-6 border-b border-gray-50 hover:bg-gray-50">수강신청</button>
                <button onclick="window.App.scrollToSection('reviews'); window.App.toggleMobileMenu()" class="text-left py-4 px-6 border-b border-gray-50 hover:bg-gray-50">강의후기</button>
                <button onclick="window.App.scrollToSection('faq'); window.App.toggleMobileMenu()" class="text-left py-4 px-6 border-b border-gray-50 hover:bg-gray-50">고객센터</button>
            </div>
        </div>
    </header>

    <!-- 메인 컨텐츠 영역 (SPA) -->
    <main id="main-container" class="flex-grow">
        
        <!-- [VIEW 1] 홈 화면 -->
        <div id="view-home" class="view-section">
            <!-- Hero -->
            <section class="relative overflow-hidden bg-gray-900 min-h-[600px] flex items-center">
                <div class="absolute inset-0 bg-gradient-to-br from-gray-900 via-[#1e293b] to-indigo-950 z-0"></div>
                <div class="absolute inset-0 opacity-10" style="background-image: url('https://www.transparenttextures.com/patterns/cubes.png');"></div>
                
                <div class="max-w-7xl mx-auto px-4 w-full flex flex-col md:flex-row items-center justify-between gap-10 relative z-10 py-16">
                    <div class="text-center md:text-left text-white w-full md:w-[60%]">
                        <div class="inline-block px-4 py-1.5 bg-indigo-500/20 backdrop-blur-md rounded-full text-sm font-bold border border-indigo-400/30 text-indigo-300 mb-6">
                            🏆 대한민국 1호 아파트 큐레이터
                        </div>
                        <h1 class="text-4xl sm:text-5xl md:text-6xl lg:text-[4.5rem] font-jalnan leading-tight mb-6">
                            부동산 유목민의<br>
                            <span class="text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 to-yellow-500">마지막 종착지!</span>
                        </h1>
                        <p class="text-gray-300 text-lg md:text-xl mb-10 font-light leading-relaxed">
                            김작가TV, 신사임당, 월부 등 압도적 초청!<br>
                            <strong class="text-white font-bold border-b-2 border-indigo-500">내 집 마련과 투자의 완결</strong>을 설계합니다.
                        </p>
                        <button onclick="window.App.scrollToSection('pricing')" class="px-8 py-4 rounded-full font-bold text-lg bg-indigo-600 text-white hover:bg-indigo-500 transition-all shadow-[0_0_30px_rgba(79,70,229,0.4)] flex items-center justify-center gap-2 mx-auto md:mx-0">
                            지금 바로 시작하기 <i data-lucide="arrow-right" class="w-5 h-5"></i>
                        </button>
                    </div>
                    
                    <!-- 책 이미지 -->
                    <div class="w-full md:w-[40%] relative h-[300px] md:h-[400px] flex items-center justify-center animate-float">
                        <div class="absolute w-72 h-72 bg-indigo-600/30 rounded-full blur-[80px] animate-pulse"></div>
                        <a href="https://www.yes24.com/product/goods/104491194" target="_blank" class="absolute transform -rotate-12 -translate-x-8 hover:z-20 hover:scale-110 hover:rotate-0 transition-all duration-500 cursor-pointer z-10">
                            <img src="https://image.yes24.com/goods/104491194/XL" alt="책1" class="w-40 md:w-52 rounded-r-lg shadow-2xl border-l-2 border-gray-700">
                        </a>
                        <a href="https://www.yes24.com/product/goods/122689813" target="_blank" class="absolute transform rotate-6 translate-x-8 z-10 hover:z-20 hover:scale-110 hover:rotate-0 transition-all duration-500 cursor-pointer">
                            <img src="https://image.yes24.com/goods/122689813/XL" alt="책2" class="w-40 md:w-52 rounded-r-lg shadow-2xl border-l-2 border-gray-700">
                        </a>
                    </div>
                </div>
            </section>

            <!-- About Section -->
            <section id="about" class="py-24 bg-white">
                <div class="max-w-6xl mx-auto px-4">
                    <div class="flex flex-col lg:flex-row items-center gap-16">
                        <div class="w-full lg:w-1/2 relative">
                            <div class="bg-gray-100 rounded-[2.5rem] p-6 relative z-10 border border-gray-200 shadow-xl">
                                <div class="aspect-[4/5] bg-gray-200 rounded-[2rem] overflow-hidden relative border-2 border-gray-300">
                                    <img src="./3.jpg" onerror="this.src='https://images.unsplash.com/photo-1560250097-0b93528c311a?q=80&w=1000&auto=format&fit=crop'" alt="시크릿브라더" class="w-full h-full object-cover">
                                </div>
                                <div class="absolute top-10 right-10 bg-white/90 backdrop-blur px-4 py-2 rounded-full shadow-lg border border-gray-100 text-sm font-bold text-indigo-600 flex items-center gap-2 animate-bounce">
                                    <i data-lucide="award" class="w-4 h-4 fill-current"></i> 서울머니쇼 초청강사
                                </div>
                            </div>
                        </div>

                        <div class="w-full lg:w-1/2">
                            <span class="text-indigo-600 font-bold tracking-widest text-sm mb-2 block">WHO AM I</span>
                            <h2 class="text-3xl md:text-4xl font-jalnan mb-6 leading-tight">
                                '아파트 큐레이터'<br>
                                <span class="text-indigo-600 relative inline-block">시크릿브라더</span>입니다.
                            </h2>
                            <div class="text-gray-600 text-lg leading-relaxed mb-8 space-y-4 break-keep border-l-4 border-gray-200 pl-6">
                                <p class="font-bold text-gray-900">"아직도 살지 말지 고민하시나요?"</p>
                                <p>저는 대한민국 1호 ‘초이스헬퍼’로서 여러분의 후회 없는 선택을 설계해드리고 있습니다. 실제 투자와 상담으로 검증된 인사이트로, 당신에게 맞는 한 채를 함께 고르겠습니다.</p>
                            </div>
                            
                            <div class="space-y-3 mb-8">
                                <a href="https://youtu.be/Xg5GV-b-7rU?si=UtnPM4Z31Hnn-VxB" target="_blank" class="flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-100 hover:bg-white hover:border-red-200 hover:shadow-lg transition-all group">
                                    <span class="w-6 h-6 bg-indigo-100 rounded-full flex items-center justify-center text-xs font-bold text-indigo-700 flex-shrink-0">1</span>
                                    <div class="flex-1 font-bold text-gray-800 group-hover:text-red-600">김작가TV & 신사임당 & 월부 출연 영상</div>
                                    <i data-lucide="youtube" class="text-gray-400 group-hover:text-red-600"></i>
                                </a>
                                <a href="https://blog.naver.com/secret-brother" target="_blank" class="flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-100 hover:bg-white hover:border-green-200 hover:shadow-lg transition-all group">
                                    <span class="w-6 h-6 bg-indigo-100 rounded-full flex items-center justify-center text-xs font-bold text-indigo-700 flex-shrink-0">2</span>
                                    <div class="flex-1 font-bold text-gray-800 group-hover:text-green-600">누적 방문자 200만 블로거 <span class="text-gray-400 font-normal text-xs">(성공한 형의 비밀일기장)</span></div>
                                    <i data-lucide="external-link" class="text-gray-400 group-hover:text-green-600"></i>
                                </a>
                                <a href="https://www.youtube.com/@secretbrother_official" target="_blank" class="flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-100 hover:bg-white hover:border-red-200 hover:shadow-lg transition-all group">
                                    <span class="w-6 h-6 bg-indigo-100 rounded-full flex items-center justify-center text-xs font-bold text-indigo-700 flex-shrink-0">3</span>
                                    <div class="flex-1 font-bold text-gray-800 group-hover:text-red-600">시크릿브라더 유튜브 채널 운영</div>
                                    <i data-lucide="youtube" class="text-gray-400 group-hover:text-red-600"></i>
                                </a>
                                <a href="https://cafe.naver.com/f-e/cafes/12730407/members/NLGMlLKgwIgd43sXBQbqw63HggHmL08BGrf6Q6JMNJM?tab=articles" target="_blank" class="flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-100 hover:bg-white hover:border-green-200 hover:shadow-lg transition-all group">
                                    <span class="w-6 h-6 bg-indigo-100 rounded-full flex items-center justify-center text-xs font-bold text-indigo-700 flex-shrink-0">4</span>
                                    <div class="flex-1 font-bold text-gray-800 group-hover:text-green-600">부동산스터디카페 인기 칼럼리스트</div>
                                    <i data-lucide="external-link" class="text-gray-400 group-hover:text-green-600"></i>
                                </a>
                            </div>
                            
                            <a href="https://youtu.be/j0hFCMX5Qlc?si=U3O5iBJjyOPEQl1g" target="_blank" class="w-full md:w-auto px-8 py-4 bg-gray-900 text-white rounded-xl font-bold flex items-center justify-center gap-3 hover:bg-gray-800 transition-all shadow-lg">
                                <i data-lucide="play-circle" class="w-5 h-5"></i> 시크릿브라더 대표 영상 보기
                            </a>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Curriculum Section -->
            <section id="curriculum" class="py-24 bg-gray-900 text-white relative overflow-hidden">
                <div class="absolute inset-0 bg-gray-900 opacity-20" style="background-image: url('https://www.transparenttextures.com/patterns/stardust.png');"></div>
                <div class="max-w-6xl mx-auto px-4 relative z-10">
                    <div class="text-center mb-16">
                        <span class="text-indigo-400 font-bold tracking-widest text-sm mb-2 block">SYSTEM</span>
                        <h2 class="text-3xl md:text-4xl font-jalnan mb-4">1:1 큐레이팅 프로세스</h2>
                        <p class="text-gray-400">체계적인 4단계 시스템으로 당신의 내 집 마련을 완성합니다.</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 relative">
                        <div class="hidden md:block absolute top-12 left-0 w-full h-0.5 bg-gradient-to-r from-gray-800 via-indigo-600 to-gray-800"></div>
                        <div class="bg-gray-800/50 backdrop-blur border border-gray-700 p-8 rounded-2xl relative group hover:-translate-y-2 transition-transform duration-300">
                            <div class="w-16 h-16 rounded-full bg-indigo-600 flex items-center justify-center font-bold text-2xl mb-6 mx-auto shadow-[0_0_20px_rgba(79,70,229,0.5)] z-10 relative">1</div>
                            <h3 class="text-xl font-bold mb-2 text-center">사전 설문</h3>
                            <p class="text-sm text-gray-400 text-center break-keep">투자 성향 및 자산 현황을 정밀하게 진단합니다.</p>
                        </div>
                        <div class="bg-gray-800/50 backdrop-blur border border-gray-700 p-8 rounded-2xl relative group hover:-translate-y-2 transition-transform duration-300">
                            <div class="w-16 h-16 rounded-full bg-indigo-700 flex items-center justify-center font-bold text-2xl mb-6 mx-auto shadow-[0_0_20px_rgba(67,56,202,0.5)] z-10 relative">2</div>
                            <h3 class="text-xl font-bold mb-2 text-center">맞춤 분석</h3>
                            <p class="text-sm text-gray-400 text-center break-keep">최적의 지역과 단지를 선정하고 포트폴리오를 설계합니다.</p>
                        </div>
                        <div class="bg-gray-800/50 backdrop-blur border border-gray-700 p-8 rounded-2xl relative group hover:-translate-y-2 transition-transform duration-300">
                            <div class="w-16 h-16 rounded-full bg-indigo-800 flex items-center justify-center font-bold text-2xl mb-6 mx-auto shadow-[0_0_20px_rgba(55,48,163,0.5)] z-10 relative">3</div>
                            <h3 class="text-xl font-bold mb-2 text-center">1:1 밀착 상담</h3>
                            <p class="text-sm text-gray-400 text-center break-keep">7일간 카카오톡을 통해 실시간 솔루션을 제공합니다.</p>
                        </div>
                        <div class="bg-gray-800/50 backdrop-blur border border-yellow-500/30 p-8 rounded-2xl relative group hover:-translate-y-2 transition-transform duration-300">
                            <div class="w-16 h-16 rounded-full bg-yellow-500 text-indigo-900 flex items-center justify-center font-bold text-2xl mb-6 mx-auto shadow-[0_0_20px_rgba(234,179,8,0.5)] z-10 relative">4</div>
                            <h3 class="text-xl font-bold mb-2 text-center text-yellow-400">실행 및 관리</h3>
                            <p class="text-sm text-gray-400 text-center break-keep">매수 타이밍 설정 및 향후 방향성까지 제시합니다.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Pricing Section -->
            <section id="pricing" class="py-24 bg-indigo-50/50">
                <div class="max-w-4xl mx-auto px-4">
                    <div class="bg-white rounded-[2rem] shadow-2xl overflow-hidden border border-indigo-100 relative">
                        <div class="absolute top-0 w-full h-2 bg-gradient-to-r from-indigo-500 to-purple-600"></div>
                        <div class="p-10 md:p-14 text-center">
                            <span class="inline-block py-1 px-3 rounded-full text-xs font-bold mb-6 bg-indigo-100 text-indigo-700 tracking-wide">PREMIUM SERVICE</span>
                            <h2 class="text-3xl md:text-4xl font-jalnan text-gray-900 mb-4">1:1 맞춤형 투자 큐레이팅</h2>
                            <p class="text-gray-500 mb-10 max-w-lg mx-auto break-keep">당신의 자산 상황과 목표에 맞춘 100% 개인화 포트폴리오 제안 및 심층 상담 서비스입니다.</p>
                            
                            <div class="flex flex-col items-center justify-center mb-10">
                                <span class="text-gray-400 text-xl line-through decoration-red-400 decoration-2 mb-1">699,000원</span>
                                <div class="flex items-center gap-3">
                                    <div class="flex items-baseline gap-1">
                                        <span class="text-6xl font-extrabold text-indigo-600 font-jalnan">349,000</span>
                                        <span class="text-2xl text-gray-600 font-bold">원</span>
                                    </div>
                                    <span class="bg-red-500 text-white text-base font-bold px-3 py-1 rounded-full shadow-lg animate-bounce transform -rotate-2">
                                        50% OFF
                                    </span>
                                </div>
                            </div>

                            <div class="grid gap-4 max-w-sm mx-auto">
                                <a href="https://portone.io/korea/ko" target="_blank" onclick="window.App.checkPayment(event, this.href)" class="w-full py-4 bg-gray-900 hover:bg-gray-800 text-white rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all flex items-center justify-center gap-2">
                                    <i data-lucide="credit-card" class="w-5 h-5"></i> 카드 / 간편결제 신청
                                </a>
                                <button onclick="window.App.openModal('depositModal')" class="w-full py-4 bg-white border-2 border-gray-200 text-gray-700 hover:border-indigo-500 hover:text-indigo-600 rounded-xl font-bold text-lg transition-all flex items-center justify-center gap-2">
                                    <i data-lucide="wallet" class="w-5 h-5"></i> 무통장 입금 신청
                                </button>
                            </div>
                            
                            <div class="mt-8 p-4 bg-red-50 rounded-xl text-left border border-red-100">
                                <div class="flex gap-2 items-start">
                                    <i data-lucide="alert-circle" class="w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"></i>
                                    <p class="text-sm text-red-600 font-medium leading-relaxed break-keep">
                                        현재 결제 시스템 점검으로 인해 카드 결제가 원활하지 않을 수 있습니다. 문제 발생 시 <strong>'무통장 입금'</strong> 후 폼 작성을 부탁드립니다. (현금영수증 발행 가능)
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Reviews Section -->
            <section id="reviews" class="py-24 bg-white">
                <div class="max-w-7xl mx-auto px-4">
                    <div class="text-center mb-16">
                        <span class="text-indigo-600 font-bold tracking-widest text-sm mb-2 block">REVIEWS</span>
                        <h2 class="text-3xl md:text-4xl font-jalnan mb-4">수강생 리얼 후기</h2>
                        <p class="text-gray-600">조작 없는 100% 실제 수강생들의 이야기입니다.</p>
                    </div>
                    
                    <div class="mb-12">
                        <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                            <i data-lucide="trophy" class="text-yellow-500 fill-current w-6 h-6"></i> 명예의 전당 (BEST)
                        </h3>
                        <div id="best-reviews-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 min-h-[200px]"></div>
                    </div>
                    
                    <div class="text-center">
                        <button onclick="window.App.navigate('reviews')" class="inline-flex items-center gap-2 bg-white border-2 border-indigo-600 text-indigo-600 hover:bg-indigo-600 hover:text-white px-10 py-4 rounded-full font-bold text-lg transition-all shadow-md hover:shadow-lg group">
                            실시간 전체 후기 보러가기 <i data-lucide="arrow-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
                        </button>
                        <p class="text-gray-400 text-sm mt-3">지금 이 순간에도 후기가 올라오고 있습니다!</p>
                    </div>
                </div>
            </section>

            <!-- FAQ Section -->
            <section id="faq" class="py-24 bg-gray-50">
                <div class="max-w-3xl mx-auto px-4">
                    <h2 class="text-3xl font-jalnan text-center mb-12">자주 묻는 질문</h2>
                    <div class="space-y-4">
                        <div class="bg-white rounded-2xl border border-gray-200 overflow-hidden">
                            <button onclick="window.App.toggleFaq(this)" class="w-full flex justify-between items-center p-6 text-left hover:bg-gray-50 transition-colors">
                                <span class="font-bold text-lg text-gray-800 flex items-center gap-3"><span class="text-indigo-600">Q.</span> 큐레이팅 진행 방식이 어떻게 되나요?</span>
                                <i data-lucide="chevron-down" class="text-gray-400 transition-transform duration-300"></i>
                            </button>
                            <div class="hidden px-6 pb-6 pt-0 text-gray-600 leading-relaxed pl-12 border-t border-dashed border-gray-100 mt-2">
                                결제 후 사전 설문지를 작성해주시면, 시크릿브라더가 직접 분석 후 7일간 카카오톡을 통해 실시간으로 1:1 상담과 솔루션을 제공해드립니다.
                            </div>
                        </div>
                        <div class="bg-white rounded-2xl border border-gray-200 overflow-hidden">
                            <button onclick="window.App.toggleFaq(this)" class="w-full flex justify-between items-center p-6 text-left hover:bg-gray-50 transition-colors">
                                <span class="font-bold text-lg text-gray-800 flex items-center gap-3"><span class="text-indigo-600">Q.</span> 결제 후 언제부터 시작되나요?</span>
                                <i data-lucide="chevron-down" class="text-gray-400 transition-transform duration-300"></i>
                            </button>
                            <div class="hidden px-6 pb-6 pt-0 text-gray-600 leading-relaxed pl-12 border-t border-dashed border-gray-100 mt-2">
                                결제 완료 후 24시간 이내에 해피콜(또는 안내 문자)을 드리며, 고객님의 일정에 맞춰 상담 시작일을 조율합니다.
                            </div>
                        </div>
                    </div>
                    <div class="mt-12 text-center">
                        <a href="https://open.kakao.com/o/sheKqImd" target="_blank" class="inline-flex items-center gap-2 bg-[#FEE500] text-[#3c1e1e] px-8 py-4 rounded-xl font-bold hover:shadow-md transition-all">
                            <i data-lucide="message-circle" class="w-5 h-5"></i> 카카오톡 문의하기
                        </a>
                    </div>
                </div>
            </section>
        </div>

        <!-- [VIEW 2] 전체 후기 화면 -->
        <div id="view-reviews" class="view-section hidden">
            <header class="bg-white border-b border-gray-200 sticky top-0 z-50">
                <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
                    <button onclick="window.App.navigate('home')" class="flex items-center gap-2 group text-indigo-600 font-bold hover:text-indigo-800 transition-colors">
                        <i data-lucide="arrow-left" class="w-6 h-6"></i> 홈으로 돌아가기
                    </button>
                    <div class="text-xl font-bold text-indigo-900">수강생 리얼 후기</div>
                </div>
            </header>
            
            <div class="max-w-7xl mx-auto px-4 py-12">
                <div class="flex flex-col md:flex-row justify-between items-end mb-8 gap-4">
                    <div>
                        <h1 class="text-3xl font-jalnan text-gray-900 mb-2">실시간 수강 후기</h1>
                        <p class="text-gray-600">지금 이 순간에도 새로운 후기가 올라오고 있습니다. (총 <span id="total-review-count" class="font-bold text-indigo-600">0</span>개)</p>
                    </div>
                    <button onclick="window.App.checkWritePermission()" class="bg-indigo-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-indigo-700 transition-all shadow-md flex items-center gap-2">
                        <i data-lucide="pen-tool" class="w-4 h-4"></i> 나도 후기 쓰기
                    </button>
                </div>
                
                <div id="all-reviews-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- JS로 렌더링 -->
                </div>
                
                <div class="text-center mt-12">
                    <button id="load-more-btn" onclick="window.App.loadMoreReviews()" class="bg-white border border-gray-300 text-gray-600 px-12 py-3 rounded-full font-bold hover:border-indigo-600 hover:text-indigo-600 transition-all">
                        후기 더보기 +
                    </button>
                </div>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-400 py-16 text-sm mt-auto">
        <div class="max-w-7xl mx-auto px-4">
            <div class="grid md:grid-cols-2 gap-10 border-b border-gray-800 pb-10 mb-10">
                <div>
                    <h3 class="text-white text-2xl font-jalnan mb-4">SecretClass</h3>
                    <p class="leading-relaxed opacity-70 break-keep">시크릿클래스는 여러분의 경제적 자유를 응원합니다.<br>투자는 본인의 판단과 책임하에 이루어져야 하며, 저희는 올바른 투자의 기준과 원칙을 제시합니다.</p>
                </div>
                <div class="md:text-right">
                    <h4 class="text-white font-bold mb-4">Customer Center</h4>
                    <p class="text-lg font-bold text-white mb-1">010-8298-4024</p>
                    <p class="opacity-60 mb-6">평일 10:00 - 18:00 (점심시간 12:00 - 13:00)</p>
                    <div class="flex flex-col md:items-end gap-1 text-xs opacity-50">
                        <p>상호명: 주식회사 아율 | 대표: 김아림</p>
                        <p>사업자등록번호: 458-88-02428 | 주소: 경기도 김포시 김포한강10로133번길 127</p>
                    </div>
                </div>
            </div>
            <div class="text-center text-xs opacity-40">© 2025 SecretClass. All rights reserved.</div>
        </div>
    </footer>

    <!-- ================= MODALS ================= -->

    <!-- 1. 로그인/회원가입 모달 -->
    <div id="loginModal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm transition-opacity" onclick="window.App.closeModal('loginModal')">
        <div class="bg-white w-full max-w-md rounded-2xl p-8 shadow-2xl relative" onclick="event.stopPropagation()">
            <button onclick="window.App.closeModal('loginModal')" class="absolute top-4 right-4 text-gray-400 hover:text-black"><i data-lucide="x"></i></button>
            <div class="flex border-b border-gray-200 mb-6">
                <button id="tab-login" onclick="window.App.switchAuthTab('login')" class="flex-1 py-3 font-bold text-indigo-600 border-b-2 border-indigo-600 transition-colors">로그인</button>
                <button id="tab-signup" onclick="window.App.switchAuthTab('signup')" class="flex-1 py-3 font-bold text-gray-400 hover:text-gray-600 transition-colors">회원가입</button>
            </div>
            <div id="form-login" class="space-y-4">
                <input type="text" id="login-identifier" class="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 focus:outline-none focus:border-indigo-500 transition-colors" placeholder="아이디 또는 이메일" >
                <input type="password" id="login-pw" class="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 focus:outline-none focus:border-indigo-500 transition-colors" placeholder="비밀번호">
                <button onclick="window.App.processLogin()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-4 rounded-xl font-bold text-lg shadow-lg shadow-indigo-200 transition-all mt-2">로그인</button>
            </div>
            <div id="form-signup" class="hidden space-y-3">
    <input type="text" id="reg-name" class="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 text-sm focus:outline-none focus:border-indigo-500" placeholder="이름">
    <input type="text" id="reg-username" class="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 text-sm focus:outline-none focus:border-indigo-500" placeholder="아이디 (영문/숫자/._- , 4~20자)">
    <input type="email" id="reg-email" class="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 text-sm focus:outline-none focus:border-indigo-500" placeholder="이메일">
    <input type="password" id="reg-pw" class="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 text-sm focus:outline-none focus:border-indigo-500" placeholder="비밀번호 (6자리 이상)">
    <input type="text" id="reg-chatid" class="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 text-sm focus:outline-none focus:border-indigo-500" placeholder="단톡방 아이디 (선택)">
    <select id="reg-joinsource" class="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 text-sm focus:outline-none focus:border-indigo-500">
        <option value="" selected disabled>가입경로 선택</option>
        <option value="blog">블로그</option>
        <option value="youtube">유튜브</option>
        <option value="etc">기타</option>
    </select>
    <button onclick="window.App.processSignup()" class="w-full bg-gray-900 hover:bg-gray-800 text-white py-4 rounded-xl font-bold shadow-lg transition-all mt-4">가입완료</button>
    <p class="text-[11px] text-gray-400 break-keep">아이디는 로그인에 사용됩니다. 이메일은 비밀번호 재설정/공지 안내에 사용됩니다.</p>
</div>

        </div>
    </div>

    <!-- 2. 입금 신청 모달 -->
    <div id="depositModal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onclick="window.App.closeModal('depositModal')">
        <div class="bg-white w-full max-w-md rounded-2xl p-8 relative" onclick="event.stopPropagation()">
            <button onclick="window.App.closeModal('depositModal')" class="absolute top-4 right-4 text-gray-400 hover:text-black"><i data-lucide="x"></i></button>
            <h3 class="text-2xl font-bold text-center mb-6 font-jalnan">무통장 입금 안내</h3>
            <div class="bg-gray-50 p-6 rounded-xl border border-gray-100 mb-6 text-center">
                <p class="text-gray-500 text-sm mb-1">기업은행</p>
                <p class="text-2xl font-bold text-indigo-600 cursor-pointer hover:scale-105 transition-transform" onclick="window.App.copyToClipboard('521-063745-04-011')">521-063745-04-011</p>
                <p class="text-xs text-gray-400 mt-2">(주)아율</p>
            </div>
            <a href="https://naver.me/FeN7ayAf" target="_blank" onclick="window.App.confirmDeposit()" class="block w-full bg-indigo-600 text-white py-4 rounded-xl font-bold text-center hover:bg-indigo-700 shadow-lg transition-all">입금 확인 폼 작성하기</a>
        </div>
    </div>

    <!-- 3. 후기 상세 모달 -->
    <div id="reviewDetailModal" class="hidden fixed inset-0 z-[110] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onclick="window.App.closeModal('reviewDetailModal')">
        <div class="bg-white w-full max-w-2xl max-h-[80vh] rounded-2xl shadow-2xl relative flex flex-col overflow-hidden" onclick="event.stopPropagation()">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50">
                <h3 class="font-bold text-gray-900">후기 상세</h3>
                <button onclick="window.App.closeModal('reviewDetailModal')" class="text-gray-400 hover:text-gray-600"><i data-lucide="x"></i></button>
            </div>
            <div class="p-8 overflow-y-auto flex-grow custom-scrollbar">
                <div class="flex items-center gap-2 mb-4" id="modal-stars"></div>
                <h2 id="modal-review-title" class="text-2xl font-bold text-gray-900 mb-6 leading-snug break-keep"></h2>
                <div id="modal-review-content" class="raw-content text-base decoded-content"></div>
                <div class="mt-8 pt-6 border-t border-gray-100 flex justify-between items-center text-sm text-gray-500">
                    <div class="flex items-center gap-2">
                        <span class="font-bold text-gray-900" id="modal-review-author"></span>
                        <span class="w-px h-3 bg-gray-300"></span>
                        <span id="modal-review-date"></span>
                    </div>
                    <div class="flex items-center gap-1"><i data-lucide="eye" class="w-4 h-4"></i> <span id="modal-review-views"></span></div>
                </div>
            </div>
            <div class="p-4 bg-gray-50 border-t border-gray-100 text-center">
                <button onclick="window.App.closeModal('reviewDetailModal')" class="w-full bg-gray-900 text-white py-3 rounded-xl font-bold hover:bg-gray-800 transition-colors">닫기</button>
            </div>
        </div>
    </div>

    <!-- 4. 후기 작성 모달 -->
    <div id="writeReviewModal" class="hidden fixed inset-0 z-[110] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onclick="window.App.closeModal('writeReviewModal')">
        <div class="bg-white w-full max-w-lg rounded-2xl shadow-2xl relative" onclick="event.stopPropagation()">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50">
                <h3 class="font-bold text-gray-900">후기 작성</h3>
                <button onclick="window.App.closeModal('writeReviewModal')" class="text-gray-400 hover:text-black"><i data-lucide="x"></i></button>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">제목</label>
                    <input type="text" id="w-title" class="w-full border border-gray-300 rounded-lg p-3 text-sm focus:border-indigo-500 focus:outline-none" placeholder="제목을 입력하세요">
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">내용</label>
                    <textarea id="w-content" rows="6" class="w-full border border-gray-300 rounded-lg p-3 text-sm focus:border-indigo-500 focus:outline-none" placeholder="솔직한 후기를 남겨주세요"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">별점</label>
                    <select id="w-rating" class="w-full border border-gray-300 rounded-lg p-3 text-sm focus:border-indigo-500 focus:outline-none">
                        <option value="5">★★★★★ (5점)</option>
                        <option value="4">★★★★☆ (4점)</option>
                        <option value="3">★★★☆☆ (3점)</option>
                    </select>
                </div>
                <button onclick="window.App.submitReview()" class="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold hover:bg-indigo-700 transition-all mt-2">등록하기</button>
            </div>
        </div>
    </div>

    <!-- 5. 마이페이지 모달 -->
    <div id="mypageModal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onclick="window.App.closeModal('mypageModal')">
        <div class="bg-white w-full max-w-sm rounded-2xl p-0 shadow-2xl overflow-hidden relative" onclick="event.stopPropagation()">
            <div class="bg-indigo-600 p-6 text-white text-center relative">
                <button onclick="window.App.closeModal('mypageModal')" class="absolute top-4 right-4 text-white/70 hover:text-white"><i data-lucide="x"></i></button>
                <div class="w-16 h-16 bg-white rounded-full mx-auto mb-3 flex items-center justify-center text-2xl font-bold text-indigo-600">S</div>
                <h3 class="font-bold text-lg" id="mp-name">게스트</h3>
                <p class="text-xs text-indigo-200" id="mp-email">로그인이 필요합니다</p>
            </div>
            <div class="p-6">
                <div id="mp-status-guest" class="text-center py-4">
                    <p class="text-gray-500 mb-4 text-sm">로그인 후 이용해주세요.</p>
                    <button onclick="window.App.closeModal('mypageModal'); window.App.openModal('loginModal','login')" class="w-full bg-indigo-600 text-white py-2 rounded-lg font-bold text-sm">로그인하기</button>
                </div>
                <div id="mp-status-user" class="hidden text-center space-y-3">
                    <div id="pay-none" class="bg-gray-100 p-4 rounded-xl">
                        <p class="text-gray-500 text-xs mb-2">수강 신청 내역이 없습니다.</p>
                        <button onclick="window.App.closeModal('mypageModal'); window.App.scrollToSection('pricing')" class="text-indigo-600 font-bold text-sm hover:underline">신청하러 가기</button>
                    </div>
                    <div id="pay-pending" class="hidden bg-yellow-50 p-4 rounded-xl border border-yellow-100">
                        <p class="font-bold text-yellow-700 text-sm">입금 확인 중입니다</p>
                        <p class="text-xs text-yellow-600 mt-1">24시간 내 승인 예정</p>
                    </div>
                    <div id="pay-complete" class="hidden bg-green-50 p-4 rounded-xl border border-green-100">
                        <p class="font-bold text-green-700 text-sm mb-2">PREMIUM 수강 중</p>
                        <button id="btn-enter-classroom" class="w-full bg-indigo-600 text-white py-2 rounded-lg text-xs font-bold mb-2 hover:bg-indigo-700 transition-all">강의실 입장</button>
                        <a href="https://open.kakao.com/o/sfyp9Qxh" target="_blank" class="block bg-[#FEE500] py-2 rounded-lg text-xs font-bold text-[#3c1e1e]">1:1 채팅방 입장</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 6. 관리자 모달 -->
    <div id="adminModal" class="hidden fixed inset-0 z-[120] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onclick="window.App.closeModal('adminModal')">
        <div class="bg-white w-full max-w-2xl rounded-2xl p-0 shadow-2xl overflow-hidden relative flex flex-col max-h-[80vh]" onclick="event.stopPropagation()">
            <div class="bg-gray-800 p-6 text-white flex justify-between items-center">
                <div>
                    <h3 class="font-bold text-lg"><i data-lucide="shield" class="w-5 h-5 inline mr-1"></i> 관리자 패널</h3>
                    <p class="text-xs text-gray-400">회원 및 결제 관리</p>
                </div>
                <button onclick="window.App.closeModal('adminModal')" class="text-white/70 hover:text-white"><i data-lucide="x"></i></button>
            </div>
            <div class="p-6 overflow-y-auto bg-gray-50">
                <h4 class="font-bold text-gray-800 mb-4">회원 목록 (최근 가입순)</h4>
                <div id="admin-user-list" class="space-y-3">
                    <!-- JS로 렌더링 -->
                    <div class="text-center py-10 text-gray-400">불러오는 중...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 7. 이미지/비디오 모달 -->
    <div id="imageModal" class="hidden fixed inset-0 z-[120] flex items-center justify-center p-4 bg-black/90" onclick="window.App.closeModal('imageModal')">
        <div class="relative max-w-4xl" onclick="event.stopPropagation()">
            <button onclick="window.App.closeModal('imageModal')" class="absolute -top-10 right-0 text-white"><i data-lucide="x"></i></button>
            <img id="modal-image-src" src="" class="max-h-[85vh] rounded-lg">
        </div>
    </div>
    
    <div id="videoModal" class="hidden fixed inset-0 z-[120] flex items-center justify-center p-4 bg-black/90" onclick="window.App.closeModal('videoModal')">
        <div class="relative w-full max-w-4xl aspect-video bg-black rounded-xl overflow-hidden shadow-2xl" onclick="event.stopPropagation()">
            <button onclick="window.App.closeModal('videoModal')" class="absolute top-4 right-4 text-white bg-black/50 rounded-full p-2 hover:bg-black/80 transition-colors z-10"><i data-lucide="x"></i></button>
            <iframe class="w-full h-full" src="https://www.youtube.com/embed/j0hFCMX5Qlc" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
    </div>

    <script>
        // *** [중요] 정적 후기 데이터는 별도 파일에서 로드합니다. (Vercel/GitHub 배포 최적화)
// reviews_seed.json 파일을 같은 폴더에 두면 자동으로 로드됩니다.
window.STATIC_REVIEWS = [];
window.App.state.reviews = []; // Firestore 후기 + STATIC_REVIEWS가 합쳐져 표시됩니다.

    </script>

    <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { 
        getAuth, 
        signInWithEmailAndPassword, 
        createUserWithEmailAndPassword, 
        signOut, 
        onAuthStateChanged, 
        updateProfile
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { 
        getFirestore, 
        doc, 
        setDoc, 
        getDoc, 
        collection, 
        query, 
        onSnapshot, 
        orderBy, 
        addDoc, 
        updateDoc,
        runTransaction,
        serverTimestamp,
        increment
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    /*****************************************************************
     * 1) Firebase 설정 (Vercel에서는 __firebase_config 가 주입되지 않습니다)
     *    아래 값을 Firebase Console > Project settings > SDK setup 에서 복사해 넣으세요.
     *****************************************************************/
    const FIREBASE_CONFIG = {
        apiKey: "PASTE_YOUR_API_KEY",
        authDomain: "PASTE_YOUR_AUTH_DOMAIN",
        projectId: "PASTE_YOUR_PROJECT_ID",
        storageBucket: "PASTE_YOUR_STORAGE_BUCKET",
        messagingSenderId: "PASTE_YOUR_MESSAGING_SENDER_ID",
        appId: "PASTE_YOUR_APP_ID"
    };

    // 관리자 이메일(들) — admin.html, Firestore Rules에도 동일하게 반영하세요.
    const ADMIN_EMAILS = ["admin@secretclass.com"];

    // Firebase init
    const firebaseApp = initializeApp(FIREBASE_CONFIG);
    const auth = getAuth(firebaseApp);
    const db = getFirestore(firebaseApp);

    // Collections
    const userDoc = (uid) => doc(db, "users", uid);
    const usernamesDoc = (username) => doc(db, "usernames", username);
    const membersDoc = (uid) => doc(db, "members", uid);
    const reviewsCol = () => collection(db, "reviews"); // 공개 후기(기존+신규)

    // Internal state
    window.App.state = window.App.state || {};
    window.App.state.visibleReviews = window.App.state.visibleReviews || 9;
    window.App.state.seedLoaded = false;
    window.App.state.seedReviews = window.App.state.seedReviews || []; // reviews_seed.json
    window.App.state.dbReviews = window.App.state.dbReviews || [];     // Firestore
    window.App.state.reviews = []; // merged

    const mergeReviews = () => {
        const merged = [...(window.App.state.dbReviews || []), ...(window.App.state.seedReviews || [])];
        merged.sort((a, b) => (String(b.date || "")).localeCompare(String(a.date || "")));
        window.App.state.reviews = merged;
    };

    const Impl = window.Impl || {};
    Impl.renderUI = () => {
        const guestDiv = document.getElementById('auth-guest');
        const userDiv = document.getElementById('auth-user');
        const userNameSpan = document.getElementById('user-name-display');
        const adminBtn = document.getElementById('btn-admin-open'); 

        if(window.App.state.isLoggedIn && window.App.state.user) {
            if(guestDiv) guestDiv.classList.add('hidden');
            if(userDiv) {
                userDiv.classList.remove('hidden-section');
                userDiv.style.display = 'flex';
            }
            if(userNameSpan) userNameSpan.innerText = window.App.state.user.name || '회원';
            if(adminBtn) {
                if(window.App.state.isAdmin) adminBtn.classList.remove('hidden');
                else adminBtn.classList.add('hidden');
            }
        } else {
            if(guestDiv) guestDiv.classList.remove('hidden');
            if(userDiv) {
                userDiv.classList.add('hidden-section');
                userDiv.style.display = 'none';
            }
            if(adminBtn) adminBtn.classList.add('hidden');
        }

        Impl.renderBestReviews();
        Impl.renderAllReviews();
    };

    Impl.createReviewCard = (review, isBest) => {
        let stars = '';
        for(let i=0; i<5; i++) stars += `<i data-lucide="star" class="w-3 h-3 ${i < (review.rating || 5) ? 'text-yellow-400 fill-current' : 'text-gray-300'}"></i>`;

        let badgeHtml = '';
        if(review.badge === 'BEST') badgeHtml = `<span class="bg-red-100 text-red-600 text-[10px] font-bold px-1.5 py-0.5 rounded">BEST</span>`;
        else if(review.badge === 'NEW') badgeHtml = `<span class="bg-indigo-100 text-indigo-600 text-[10px] font-bold px-1.5 py-0.5 rounded">NEW</span>`;

        const bgClass = isBest ? 'hover:-translate-y-2 shadow-sm border-gray-100' : 'hover:-translate-y-1 shadow-sm border-gray-100';
        const tempDiv = document.createElement("div");
        tempDiv.innerHTML = review.content || "";
        const plainText = tempDiv.textContent || tempDiv.innerText || "";

        return `
        <div onclick="window.App.openReviewDetail('${review.id}')" class="bg-white p-6 rounded-2xl border ${bgClass} hover:shadow-xl transition-all duration-300 cursor-pointer flex flex-col justify-between h-full group">
            <div>
                <div class="flex justify-between items-start mb-3">
                    <div class="flex gap-1 items-center">${stars}</div>
                    ${badgeHtml}
                </div>
                <h3 class="font-bold text-lg mb-2 text-gray-900 line-clamp-1 group-hover:text-indigo-600 transition-colors">${review.title || ''}</h3>
                <p class="text-sm text-gray-500 line-clamp-custom mb-4 leading-relaxed break-keep">${plainText}</p>
            </div>
            <div class="pt-4 border-t border-gray-50 flex justify-between items-center text-xs text-gray-400">
                <div class="flex items-center gap-2">
                    <span class="font-bold text-gray-700">${review.author || '수강생'}</span>
                    <span>${review.date || ''}</span>
                </div>
                <div class="flex items-center gap-1"><i data-lucide="eye" class="w-3 h-3"></i> ${(review.views || 0).toLocaleString()}</div>
            </div>
        </div>`;
    };

    Impl.renderBestReviews = () => {
        const container = document.getElementById('best-reviews-container');
        if(!container) return;

        mergeReviews();
        const reviews = window.App.state.reviews || [];

        let bests = reviews.filter(r => r.badge === 'BEST');
        if(bests.length === 0) bests = [...reviews].sort((a,b) => (b.views||0)-(a.views||0));
        bests = bests.slice(0, 6);

        container.innerHTML = bests.map(r => Impl.createReviewCard(r, true)).join('');
        if(typeof lucide !== 'undefined') lucide.createIcons();
    };

    Impl.renderAllReviews = () => {
        const container = document.getElementById('all-reviews-container');
        if(!container) return;

        mergeReviews();
        const reviews = window.App.state.reviews || [];

        const visible = reviews.slice(0, window.App.state.visibleReviews);
        container.innerHTML = visible.map(r => Impl.createReviewCard(r, false)).join('');

        const loadBtn = document.getElementById('load-more-btn'); 
        if(loadBtn) loadBtn.style.display = (window.App.state.visibleReviews >= reviews.length) ? 'none' : 'inline-block';
        const totalCnt = document.getElementById('total-review-count');
        if(totalCnt) totalCnt.innerText = reviews.length;

        if(typeof lucide !== 'undefined') lucide.createIcons();
    };

    /*****************************************************************
     * 2) 기본 UI 핸들러 (기존 버튼 먹통 원인: 빈 스텁 함수)
     *****************************************************************/
    window.App.navigate = (page) => {
        document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
        document.getElementById(`view-${page}`)?.classList.remove('hidden');
        window.scrollTo(0,0);
    };

    window.App.scrollToSection = (id) => {
        if(document.getElementById('view-home')?.classList.contains('hidden')) window.App.navigate('home');
        setTimeout(()=> document.getElementById(id)?.scrollIntoView({behavior:'smooth'}), 100);
    };

    window.App.toggleMobileMenu = () => {
        document.getElementById('mobileMenu')?.classList.toggle('hidden');
    };

    window.App.openModal = (id, tab) => {
        document.getElementById(id)?.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
        if(tab) window.App.switchAuthTab(tab);
    };

    window.App.closeModal = (id) => {
        document.getElementById(id)?.classList.add('hidden');
        document.body.style.overflow = '';
    };

    window.App.switchAuthTab = (tab) => {
        const loginForm = document.getElementById('form-login');
        const signupForm = document.getElementById('form-signup');
        const loginTab = document.getElementById('tab-login');
        const signupTab = document.getElementById('tab-signup');

        if(tab === 'login') {
            loginForm?.classList.remove('hidden');
            signupForm?.classList.add('hidden');
            if(loginTab) loginTab.className = "flex-1 py-3 font-bold text-indigo-600 border-b-2 border-indigo-600 transition-colors";
            if(signupTab) signupTab.className = "flex-1 py-3 font-bold text-gray-400 hover:text-gray-600 transition-colors";
        } else {
            loginForm?.classList.add('hidden');
            signupForm?.classList.remove('hidden');
            if(signupTab) signupTab.className = "flex-1 py-3 font-bold text-indigo-600 border-b-2 border-indigo-600 transition-colors";
            if(loginTab) loginTab.className = "flex-1 py-3 font-bold text-gray-400 hover:text-gray-600 transition-colors";
        }
    };

    window.App.toggleFaq = (btn) => {
        const answer = btn.nextElementSibling;
        const icon = btn.querySelector('.lucide-chevron-down');
        const isHidden = answer.classList.contains('hidden');
        answer.classList.toggle('hidden');
        if(icon) icon.style.transform = isHidden ? 'rotate(180deg)' : 'rotate(0deg)';
    };

    window.App.copyToClipboard = (text) => {
        const el = document.createElement('textarea');
        el.value = text;
        document.body.appendChild(el);
        el.select();
        document.execCommand('copy');
        document.body.removeChild(el);
        alert("계좌번호가 복사되었습니다.");
    };

    // 결제 페이지/링크는 현재 데모로 유지(원하시면 PG 연동 구조를 별도로 설계해야 합니다)
    window.App.checkPayment = (e, url) => {
        if(url && url.includes('portone')) {
            e.preventDefault();
            window.open(url);
            alert("결제창이 열렸습니다. (데모환경)");
        }
    };

    window.App.confirmDeposit = async () => {
        if(!window.App.state.isLoggedIn || !window.App.state.user) return alert("로그인 후 신청해주세요.");
        const uid = window.App.state.user.uid;

        await updateDoc(userDoc(uid), { payStatus: 'pending' });
        await setDoc(membersDoc(uid), { payStatus: 'pending' }, { merge: true });

        window.App.state.user.payStatus = 'pending';
        window.App.closeModal('depositModal');
        alert("입금 확인 요청이 접수되었습니다. 관리자 승인 후 강의실 입장이 가능합니다.");
        window.App.openMypage();
    };

    window.App.checkWritePermission = () => {
        if(!window.App.state.isLoggedIn) {
            alert("로그인을 하세요");
            window.App.openModal('loginModal', 'login');
            return;
        }
        const payStatus = window.App.state.user?.payStatus || 'none';
        if(payStatus !== 'complete') {
            if(payStatus === 'pending') alert("입금 확인 중입니다. 승인 후 작성 가능합니다.");
            else alert("수강생만 작성 가능합니다. 수강신청을 먼저 진행해주세요.");
            return;
        }
        window.App.openModal('writeReviewModal');
    };

    window.App.openMypage = () => {
        window.App.openModal('mypageModal');
        const isUser = !!window.App.state.isLoggedIn;
        const payStatus = window.App.state.user ? (window.App.state.user.payStatus || 'none') : 'none';

        document.getElementById('mp-status-guest')?.classList.toggle('hidden', isUser);
        document.getElementById('mp-status-user')?.classList.toggle('hidden', !isUser);

        if(isUser && window.App.state.user) {
            document.getElementById('mp-name').innerText = (window.App.state.user.name || "회원") + "님";
            document.getElementById('mp-email').innerText = window.App.state.user.email || "";

            document.getElementById('pay-none')?.classList.toggle('hidden', payStatus !== 'none');
            document.getElementById('pay-pending')?.classList.toggle('hidden', payStatus !== 'pending');
            document.getElementById('pay-complete')?.classList.toggle('hidden', payStatus !== 'complete');

            // pay-complete 영역 안에 "강의실 입장" 버튼이 있으면 활성화
            const enterBtn = document.getElementById('btn-enter-classroom');
            if(enterBtn) {
                enterBtn.onclick = () => window.location.href = "./classroom.html";
                enterBtn.disabled = (payStatus !== 'complete');
            }
        }
    };

    window.App.openAdminModal = () => {
        window.location.href = "./admin.html";
    };

    /*****************************************************************
     * 3) 정적 후기 로드 (board.sql 기반 원본)
     *****************************************************************/
    async function loadSeedReviews() {
        try {
            const res = await fetch("./reviews_seed.json", { cache: "no-store" });
            if(!res.ok) throw new Error("reviews_seed.json not found");
            const data = await res.json();
            window.App.state.seedReviews = data || [];
            window.App.state.seedLoaded = true;
            Impl.renderUI();
        } catch (e) {
            console.warn("[Seed Reviews] load failed:", e.message);
            window.App.state.seedReviews = window.App.state.seedReviews || [];
            Impl.renderUI();
        }
    }

    /*****************************************************************
     * 4) Auth (아이디 또는 이메일 로그인)
     *****************************************************************/
    function normalizeUsername(u) {
        return String(u || "").trim().toLowerCase();
    }
    function validateUsername(u) {
        return /^[a-z0-9._-]{4,20}$/.test(u);
    }

    window.App.processLogin = async () => {
        const identifier = document.getElementById('login-identifier')?.value?.trim();
        const pw = document.getElementById('login-pw')?.value;

        if(!identifier || !pw) return alert('아이디/이메일과 비밀번호를 입력해주세요.');

        try {
            let email = identifier;
            if(!identifier.includes("@")) {
                const username = normalizeUsername(identifier);
                const snap = await getDoc(usernamesDoc(username));
                if(!snap.exists()) return alert("존재하지 않는 아이디입니다.");
                email = snap.data().email;
            }
            await signInWithEmailAndPassword(auth, email, pw);
            alert("로그인되었습니다.");
            window.App.closeModal('loginModal');
        } catch (e) {
            console.error(e);
            alert("로그인 실패: 아이디/이메일 또는 비밀번호를 확인해주세요.");
        }
    };

    window.App.processSignup = async () => {
        const name = document.getElementById('reg-name')?.value?.trim();
        const usernameRaw = document.getElementById('reg-username')?.value?.trim();
        const email = document.getElementById('reg-email')?.value?.trim();
        const pw = document.getElementById('reg-pw')?.value;
        const chatId = document.getElementById('reg-chatid')?.value?.trim() || "";
        const joinSource = document.getElementById('reg-joinsource')?.value || "";

        if(!name || !usernameRaw || !email || !pw) return alert('모든 필드를 입력해주세요.');
        if(pw.length < 6) return alert('비밀번호는 6자리 이상이어야 합니다.');
        const username = normalizeUsername(usernameRaw);
        if(!validateUsername(username)) return alert("아이디 형식이 올바르지 않습니다. (영문/숫자/._- , 4~20자)");
        if(!joinSource) return alert("가입경로를 선택해주세요.");

        try {
            await runTransaction(db, async (tx) => {
                const uref = usernamesDoc(username);
                const snap = await tx.get(uref);
                if(snap.exists()) throw new Error("USERNAME_TAKEN");
                tx.set(uref, { email, reservedAt: serverTimestamp() }, { merge: false });
            });

            const cred = await createUserWithEmailAndPassword(auth, email, pw);
            await updateProfile(cred.user, { displayName: name });

            const profileData = { 
                name, username, email, chatId, joinSource,
                payStatus: 'none',
                createdAt: serverTimestamp()
            };

            await setDoc(userDoc(cred.user.uid), profileData, { merge: true });
            await setDoc(membersDoc(cred.user.uid), profileData, { merge: true });
            await setDoc(usernamesDoc(username), { uid: cred.user.uid, email }, { merge: true });

            alert("가입이 완료되었습니다.");
            window.App.switchAuthTab('login');
            window.App.closeModal('loginModal');
        } catch (e) {
            console.error(e);
            if(e.message === "USERNAME_TAKEN") return alert("이미 사용 중인 아이디입니다.");
            if(e.code === 'auth/email-already-in-use') return alert("이미 가입된 이메일입니다.");
            alert("가입 중 오류가 발생했습니다: " + (e.message || e.code));
        }
    };

    window.App.logout = () => {
        if(confirm('로그아웃 하시겠습니까?')) signOut(auth).then(() => window.location.reload());
    };

    /*****************************************************************
     * 5) 후기: Firestore 구독, 상세 열람 시 조회수 증가
     *****************************************************************/
    onSnapshot(
        query(reviewsCol(), orderBy("date", "desc")),
        (snapshot) => {
            const arr = [];
            snapshot.forEach(d => arr.push({ id: d.id, ...d.data(), _fromDb: true }));
            window.App.state.dbReviews = arr;
            Impl.renderUI();
        },
        (err) => {
            console.warn("[Firestore reviews] read blocked:", err.code);
            window.App.state.dbReviews = [];
            Impl.renderUI();
        }
    );

    window.App.openReviewDetail = async (id) => {
        mergeReviews();
        let review = (window.App.state.reviews || []).find(r => String(r.id) === String(id));
        if(!review) return;

        review.views = (review.views || 0) + 1;

        try {
            if(review._fromDb) await updateDoc(doc(db, "reviews", String(review.id)), { views: increment(1) });
        } catch(e) {}

        document.getElementById('modal-review-title').innerText = review.title || '';
        const tempTextArea = document.createElement('textarea');
        tempTextArea.innerHTML = review.content || '';
        let decodedContent = tempTextArea.value;
        if (!decodedContent.includes('<p>') && !decodedContent.includes('<br')) decodedContent = decodedContent.replace(/
/g, '<br>');
        document.getElementById('modal-review-content').innerHTML = decodedContent;
        document.getElementById('modal-review-author').innerText = review.author || '수강생';
        document.getElementById('modal-review-date').innerText = review.date || '';
        document.getElementById('modal-review-views').innerText = (review.views || 0).toLocaleString();

        let stars = '';
        for(let i=0; i<5; i++) stars += `<i data-lucide="star" class="w-4 h-4 ${i < (review.rating || 5) ? 'text-yellow-400 fill-current' : 'text-gray-300'}"></i>`;
        document.getElementById('modal-stars').innerHTML = stars;

        window.App.openModal('reviewDetailModal');
        if(typeof lucide !== 'undefined') lucide.createIcons();
    };

    window.App.loadMoreReviews = () => {
        window.App.state.visibleReviews += 9;
        Impl.renderAllReviews();
    };

    window.App.submitReview = async () => {
        if(!window.App.state.isLoggedIn || !window.App.state.user) return alert("로그인 후 작성 가능합니다.");

        const title = document.getElementById('w-title')?.value?.trim();
        const content = document.getElementById('w-content')?.value?.trim();
        const rating = parseInt(document.getElementById('w-rating')?.value || "5", 10) || 5;

        if(!title || !content) return alert("내용을 모두 입력해주세요.");
        if((window.App.state.user.payStatus || "none") !== "complete") return alert("수강생만 작성 가능합니다. (관리자 승인 후 가능)");

        try {
            await addDoc(reviewsCol(), {
                title,
                content: content.replace(/
/g, "<br>"),
                rating,
                author: window.App.state.user.name,
                date: new Date().toISOString().slice(0,10),
                views: 0,
                userId: window.App.state.user.uid,
                badge: "NEW",
                createdAt: serverTimestamp()
            });
            window.App.closeModal('writeReviewModal');
            alert("소중한 후기가 등록되었습니다!");
            document.getElementById('w-title').value = '';
            document.getElementById('w-content').value = '';
        } catch(e) {
            console.error(e);
            alert("등록 실패: " + (e.message || e.code));
        }
    };

    /*****************************************************************
     * 6) 회원 프로필 로드 + 관리자 여부 판단
     *****************************************************************/
    onAuthStateChanged(auth, async (firebaseUser) => {
        if(firebaseUser) {
            const uid = firebaseUser.uid;
            try {
                const snap = await getDoc(userDoc(uid));
                const profile = snap.exists() ? snap.data() : {};
                window.App.state.user = { uid, email: firebaseUser.email, ...profile };
                window.App.state.isLoggedIn = true;
                window.App.state.isAdmin = ADMIN_EMAILS.includes(String(firebaseUser.email || "").toLowerCase());
            } catch(e) {
                window.App.state.user = { uid, email: firebaseUser.email, name: firebaseUser.displayName || "회원", payStatus: "none" };
                window.App.state.isLoggedIn = true;
                window.App.state.isAdmin = ADMIN_EMAILS.includes(String(firebaseUser.email || "").toLowerCase());
            }
        } else {
            window.App.state.isLoggedIn = false;
            window.App.state.user = null;
            window.App.state.isAdmin = false;
        }
        Impl.renderUI();
    });

    // 첫 로드
    loadSeedReviews();
    Impl.renderUI();
    if(typeof lucide !== 'undefined') lucide.createIcons();
</script>
</body>
</html>