<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 중요: 모든 HTTP 요청을 HTTPS로 자동 업그레이드하여 혼합 콘텐츠 차단 방지 -->
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"> 
    <title>시크릿클래스 - 대한민국 1호 아파트 큐레이터</title>
    
    <!-- Tailwind CSS (HTTPS) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons (HTTPS) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* 폰트 설정 (HTTPS) */
        @font-face {
            font-family: 'Jalnan';
            src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonnu-fonts_two@1.0/Jalnan.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700&display=swap');

        /* 기본 스타일 */
        :root { --primary: #4f46e5; --primary-dark: #4338ca; }
        * { font-family: 'Jalnan', sans-serif; }
        body { font-family: 'Pretendard', sans-serif; letter-spacing: -0.02em; overflow-x: hidden; }
        
        /* 유틸리티 클래스 */
        .font-jalnan { font-family: 'Jalnan', sans-serif !important; }
        .font-body { font-family: 'Pretendard', sans-serif !important; }
        .break-keep { word-break: keep-all; word-wrap: break-word; }
        
        /* 스크롤바 커스텀 */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* 애니메이션 */
        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fade-in 0.5s ease-out forwards; }
        
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
        .animate-float { animation: float 6s ease-in-out infinite; }

        /* 화면 전환 유틸리티 */
        .hidden-section { display: none !important; }
        .hidden { display: none !important; }
        
        /* 후기 카드 텍스트 줄임 (일정 높이 유지) */
        .line-clamp-custom {
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
            overflow: hidden;
            height: 6rem; /* 높이 고정으로 카드 크기 일정하게 유지 */
        }

        /* 원본 스타일 유지 (모달용) */
        .raw-content {
            line-height: 1.7;
            white-space: pre-wrap; /* 줄바꿈 보존 */
            color: #374151;
        }
        
        /* HTML 엔티티 디코딩용 */
        .decoded-content p { margin-bottom: 1em; }
    </style>
  <!-- Optional: centralized Firebase config for GitHub Pages -->
  <script src="./js/config.js"></script>
</head>
<body class="bg-white text-gray-900 font-body flex flex-col min-h-screen">

    <!-- 1. 최상단 배너 -->
    <div class="bg-red-600 text-white text-center py-3 text-sm md:text-base shadow-md z-50 relative break-keep px-4">
        <div class="animate-pulse flex justify-center items-center gap-2">
            <span class="font-bold bg-white text-red-600 px-2 py-0.5 rounded text-xs">마감임박</span>
            <span>이번 달 큐레이팅 마감까지 <span id="countdown-number" class="text-yellow-300 font-extrabold text-lg">2</span>자리 남았습니다.</span>
        </div>
    </div>

    <!-- 2. 헤더 -->
    <header class="sticky top-0 z-40 bg-white/95 backdrop-blur-md border-b border-gray-100 transition-all duration-300">
        <!-- 로그인 상태 바 -->
        <div class="bg-gray-50 border-b border-gray-100">
            <div class="max-w-7xl mx-auto px-4 py-2 flex justify-end items-center gap-4 text-xs text-gray-500">
                <div id="auth-guest" class="flex items-center gap-3">
                    <button onclick="window.App.openModal('loginModal', 'login')" class="hover:text-indigo-600 transition-colors">로그인</button>
                    <span class="w-px h-3 bg-gray-300"></span>
                    <button onclick="window.App.openModal('loginModal', 'signup')" class="hover:text-indigo-600 transition-colors">회원가입</button>
                </div>
                <div id="auth-user" class="hidden-section flex items-center gap-3">
                    <!-- 관리자 버튼 (관리자일 때만 보임) -->
                    <button id="btn-admin-open" onclick="window.App.openAdminModal()" class="hidden bg-gray-800 text-white px-2 py-1 rounded hover:bg-gray-700 transition-colors mr-2">
                        <i data-lucide="settings" class="w-3 h-3 inline"></i> 관리자
                    </button>
                    <span class="font-bold text-gray-700"><span id="user-name-display" class="text-indigo-600"></span>님</span>
                    <span class="w-px h-3 bg-gray-300"></span>
                    <button onclick="window.App.logout()" class="hover:text-red-500 transition-colors">로그아웃</button>
                </div>
                <span class="w-px h-3 bg-gray-300"></span>
                <button onclick="window.App.openMypage()" class="font-bold text-indigo-600 hover:text-indigo-800 transition-colors flex items-center gap-1">
                    <i data-lucide="user" class="w-3 h-3"></i> 나의강의실
                </button>
            </div>
        </div>

        <!-- 네비게이션 -->
        <div class="max-w-7xl mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex justify-between items-center w-full md:w-auto">
                <a href="javascript:void(0)" onclick="window.App.navigate('home')" class="text-left group cursor-pointer">
                    <div class="text-2xl font-jalnan font-bold text-indigo-900 tracking-tighter group-hover:text-indigo-700 transition-colors">시크릿클래스</div>
                    <div class="text-[10px] text-indigo-400 tracking-[0.3em] font-light">SECRETCLASS</div>
                </a>
                <button class="md:hidden p-2" onclick="window.App.toggleMobileMenu()">
                    <i data-lucide="menu" class="h-6 w-6 text-gray-800"></i>
                </button>
            </div>
            
            <!-- 메뉴 -->
            <nav class="hidden md:flex gap-8 font-medium text-gray-600">
                <button onclick="window.App.scrollToSection('about')" class="hover:text-indigo-600 transition-colors py-2">소개</button>
                <button onclick="window.App.scrollToSection('curriculum')" class="hover:text-indigo-600 transition-colors py-2">진행과정</button>
                <button onclick="window.App.scrollToSection('pricing')" class="hover:text-indigo-600 transition-colors py-2">수강신청</button>
                <button onclick="window.App.scrollToSection('reviews')" class="hover:text-indigo-600 transition-colors py-2">강의후기</button>
                <button onclick="window.App.scrollToSection('faq')" class="hover:text-indigo-600 transition-colors py-2">고객센터</button>
            </nav>
        </div>

        <!-- 모바일 메뉴 -->
        <div id="mobileMenu" class="hidden md:hidden bg-white border-t border-gray-100 absolute w-full left-0 shadow-lg animate-fade-in">
            <div class="flex flex-col text-gray-700">
                <button onclick="window.App.scrollToSection('about'); window.App.toggleMobileMenu()" class="text-left py-4 px-6 border-b border-gray-50 hover:bg-gray-50">소개</button>
                <button onclick="window.App.scrollToSection('curriculum'); window.App.toggleMobileMenu()" class="text-left py-4 px-6 border-b border-gray-50 hover:bg-gray-50">진행과정</button>
                <button onclick="window.App.scrollToSection('pricing'); window.App.toggleMobileMenu()" class="text-left py-4 px-6 border-b border-gray-50 hover:bg-gray-50">수강신청</button>
                <button onclick="window.App.scrollToSection('reviews'); window.App.toggleMobileMenu()" class="text-left py-4 px-6 border-b border-gray-50 hover:bg-gray-50">강의후기</button>
                <button onclick="window.App.scrollToSection('faq'); window.App.toggleMobileMenu()" class="text-left py-4 px-6 border-b border-gray-50 hover:bg-gray-50">고객센터</button>
            </div>
        </div>
    </header>

    <!-- 메인 컨텐츠 영역 (SPA) -->
    <main id="main-container" class="flex-grow">
        
        <!-- [VIEW 1] 홈 화면 -->
        <div id="view-home" class="view-section">
            <!-- Hero -->
            <section class="relative overflow-hidden bg-gray-900 min-h-[600px] flex items-center">
                <div class="absolute inset-0 bg-gradient-to-br from-gray-900 via-[#1e293b] to-indigo-950 z-0"></div>
                <div class="absolute inset-0 opacity-10" style="background-image: url('https://www.transparenttextures.com/patterns/cubes.png');"></div>
                
                <div class="max-w-7xl mx-auto px-4 w-full flex flex-col md:flex-row items-center justify-between gap-10 relative z-10 py-16">
                    <div class="text-center md:text-left text-white w-full md:w-[60%]">
                        <div class="inline-block px-4 py-1.5 bg-indigo-500/20 backdrop-blur-md rounded-full text-sm font-bold border border-indigo-400/30 text-indigo-300 mb-6">
                            🏆 대한민국 1호 아파트 큐레이터
                        </div>
                        <h1 class="text-4xl sm:text-5xl md:text-6xl lg:text-[4.5rem] font-jalnan leading-tight mb-6">
                            부동산 유목민의<br>
                            <span class="text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 to-yellow-500">마지막 종착지!</span>
                        </h1>
                        <p class="text-gray-300 text-lg md:text-xl mb-10 font-light leading-relaxed">
                            김작가TV, 신사임당, 월부 등 압도적 초청!<br>
                            <strong class="text-white font-bold border-b-2 border-indigo-500">내 집 마련과 투자의 완결</strong>을 설계합니다.
                        </p>
                        <button onclick="window.App.scrollToSection('pricing')" class="px-8 py-4 rounded-full font-bold text-lg bg-indigo-600 text-white hover:bg-indigo-500 transition-all shadow-[0_0_30px_rgba(79,70,229,0.4)] flex items-center justify-center gap-2 mx-auto md:mx-0">
                            지금 바로 시작하기 <i data-lucide="arrow-right" class="w-5 h-5"></i>
                        </button>
                    </div>
                    
                    <!-- 책 이미지 -->
                    <div class="w-full md:w-[40%] relative h-[300px] md:h-[400px] flex items-center justify-center animate-float">
                        <div class="absolute w-72 h-72 bg-indigo-600/30 rounded-full blur-[80px] animate-pulse"></div>
                        <a href="https://www.yes24.com/product/goods/104491194" target="_blank" class="absolute transform -rotate-12 -translate-x-8 hover:z-20 hover:scale-110 hover:rotate-0 transition-all duration-500 cursor-pointer z-10">
                            <img src="https://image.yes24.com/goods/104491194/XL" alt="책1" class="w-40 md:w-52 rounded-r-lg shadow-2xl border-l-2 border-gray-700">
                        </a>
                        <a href="https://www.yes24.com/product/goods/122689813" target="_blank" class="absolute transform rotate-6 translate-x-8 z-10 hover:z-20 hover:scale-110 hover:rotate-0 transition-all duration-500 cursor-pointer">
                            <img src="https://image.yes24.com/goods/122689813/XL" alt="책2" class="w-40 md:w-52 rounded-r-lg shadow-2xl border-l-2 border-gray-700">
                        </a>
                    </div>
                </div>
            </section>

            <!-- About Section -->
            <section id="about" class="py-24 bg-white">
                <div class="max-w-6xl mx-auto px-4">
                    <div class="flex flex-col lg:flex-row items-center gap-16">
                        <div class="w-full lg:w-1/2 relative">
                            <div class="bg-gray-100 rounded-[2.5rem] p-6 relative z-10 border border-gray-200 shadow-xl">
                                <div class="aspect-[4/5] bg-gray-200 rounded-[2rem] overflow-hidden relative border-2 border-gray-300">
                                    <img src="./3.jpg" onerror="this.src='https://images.unsplash.com/photo-1560250097-0b93528c311a?q=80&w=1000&auto=format&fit=crop'" alt="시크릿브라더" class="w-full h-full object-cover">
                                </div>
                                <div class="absolute top-10 right-10 bg-white/90 backdrop-blur px-4 py-2 rounded-full shadow-lg border border-gray-100 text-sm font-bold text-indigo-600 flex items-center gap-2 animate-bounce">
                                    <i data-lucide="award" class="w-4 h-4 fill-current"></i> 서울머니쇼 초청강사
                                </div>
                            </div>
                        </div>

                        <div class="w-full lg:w-1/2">
                            <span class="text-indigo-600 font-bold tracking-widest text-sm mb-2 block">WHO AM I</span>
                            <h2 class="text-3xl md:text-4xl font-jalnan mb-6 leading-tight">
                                '아파트 큐레이터'<br>
                                <span class="text-indigo-600 relative inline-block">시크릿브라더</span>입니다.
                            </h2>
                            <div class="text-gray-600 text-lg leading-relaxed mb-8 space-y-4 break-keep border-l-4 border-gray-200 pl-6">
                                <p class="font-bold text-gray-900">"아직도 살지 말지 고민하시나요?"</p>
                                <p>저는 대한민국 1호 ‘초이스헬퍼’로서 여러분의 후회 없는 선택을 설계해드리고 있습니다. 실제 투자와 상담으로 검증된 인사이트로, 당신에게 맞는 한 채를 함께 고르겠습니다.</p>
                            </div>
                            
                            <div class="space-y-3 mb-8">
                                <a href="https://youtu.be/Xg5GV-b-7rU?si=UtnPM4Z31Hnn-VxB" target="_blank" class="flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-100 hover:bg-white hover:border-red-200 hover:shadow-lg transition-all group">
                                    <span class="w-6 h-6 bg-indigo-100 rounded-full flex items-center justify-center text-xs font-bold text-indigo-700 flex-shrink-0">1</span>
                                    <div class="flex-1 font-bold text-gray-800 group-hover:text-red-600">김작가TV & 신사임당 & 월부 출연 영상</div>
                                    <i data-lucide="youtube" class="text-gray-400 group-hover:text-red-600"></i>
                                </a>
                                <a href="https://blog.naver.com/secret-brother" target="_blank" class="flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-100 hover:bg-white hover:border-green-200 hover:shadow-lg transition-all group">
                                    <span class="w-6 h-6 bg-indigo-100 rounded-full flex items-center justify-center text-xs font-bold text-indigo-700 flex-shrink-0">2</span>
                                    <div class="flex-1 font-bold text-gray-800 group-hover:text-green-600">누적 방문자 200만 블로거 <span class="text-gray-400 font-normal text-xs">(성공한 형의 비밀일기장)</span></div>
                                    <i data-lucide="external-link" class="text-gray-400 group-hover:text-green-600"></i>
                                </a>
                                <a href="https://www.youtube.com/@secretbrother_official" target="_blank" class="flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-100 hover:bg-white hover:border-red-200 hover:shadow-lg transition-all group">
                                    <span class="w-6 h-6 bg-indigo-100 rounded-full flex items-center justify-center text-xs font-bold text-indigo-700 flex-shrink-0">3</span>
                                    <div class="flex-1 font-bold text-gray-800 group-hover:text-red-600">시크릿브라더 유튜브 채널 운영</div>
                                    <i data-lucide="youtube" class="text-gray-400 group-hover:text-red-600"></i>
                                </a>
                                <a href="https://cafe.naver.com/f-e/cafes/12730407/members/NLGMlLKgwIgd43sXBQbqw63HggHmL08BGrf6Q6JMNJM?tab=articles" target="_blank" class="flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-100 hover:bg-white hover:border-green-200 hover:shadow-lg transition-all group">
                                    <span class="w-6 h-6 bg-indigo-100 rounded-full flex items-center justify-center text-xs font-bold text-indigo-700 flex-shrink-0">4</span>
                                    <div class="flex-1 font-bold text-gray-800 group-hover:text-green-600">부동산스터디카페 인기 칼럼리스트</div>
                                    <i data-lucide="external-link" class="text-gray-400 group-hover:text-green-600"></i>
                                </a>
                            </div>
                            
                            <a href="https://youtu.be/j0hFCMX5Qlc?si=U3O5iBJjyOPEQl1g" target="_blank" class="w-full md:w-auto px-8 py-4 bg-gray-900 text-white rounded-xl font-bold flex items-center justify-center gap-3 hover:bg-gray-800 transition-all shadow-lg">
                                <i data-lucide="play-circle" class="w-5 h-5"></i> 시크릿브라더 대표 영상 보기
                            </a>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Curriculum Section -->
            <section id="curriculum" class="py-24 bg-gray-900 text-white relative overflow-hidden">
                <div class="absolute inset-0 bg-gray-900 opacity-20" style="background-image: url('https://www.transparenttextures.com/patterns/stardust.png');"></div>
                <div class="max-w-6xl mx-auto px-4 relative z-10">
                    <div class="text-center mb-16">
                        <span class="text-indigo-400 font-bold tracking-widest text-sm mb-2 block">SYSTEM</span>
                        <h2 class="text-3xl md:text-4xl font-jalnan mb-4">1:1 큐레이팅 프로세스</h2>
                        <p class="text-gray-400">체계적인 4단계 시스템으로 당신의 내 집 마련을 완성합니다.</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 relative">
                        <div class="hidden md:block absolute top-12 left-0 w-full h-0.5 bg-gradient-to-r from-gray-800 via-indigo-600 to-gray-800"></div>
                        <div class="bg-gray-800/50 backdrop-blur border border-gray-700 p-8 rounded-2xl relative group hover:-translate-y-2 transition-transform duration-300">
                            <div class="w-16 h-16 rounded-full bg-indigo-600 flex items-center justify-center font-bold text-2xl mb-6 mx-auto shadow-[0_0_20px_rgba(79,70,229,0.5)] z-10 relative">1</div>
                            <h3 class="text-xl font-bold mb-2 text-center">사전 설문</h3>
                            <p class="text-sm text-gray-400 text-center break-keep">투자 성향 및 자산 현황을 정밀하게 진단합니다.</p>
                        </div>
                        <div class="bg-gray-800/50 backdrop-blur border border-gray-700 p-8 rounded-2xl relative group hover:-translate-y-2 transition-transform duration-300">
                            <div class="w-16 h-16 rounded-full bg-indigo-700 flex items-center justify-center font-bold text-2xl mb-6 mx-auto shadow-[0_0_20px_rgba(67,56,202,0.5)] z-10 relative">2</div>
                            <h3 class="text-xl font-bold mb-2 text-center">맞춤 분석</h3>
                            <p class="text-sm text-gray-400 text-center break-keep">최적의 지역과 단지를 선정하고 포트폴리오를 설계합니다.</p>
                        </div>
                        <div class="bg-gray-800/50 backdrop-blur border border-gray-700 p-8 rounded-2xl relative group hover:-translate-y-2 transition-transform duration-300">
                            <div class="w-16 h-16 rounded-full bg-indigo-800 flex items-center justify-center font-bold text-2xl mb-6 mx-auto shadow-[0_0_20px_rgba(55,48,163,0.5)] z-10 relative">3</div>
                            <h3 class="text-xl font-bold mb-2 text-center">1:1 밀착 상담</h3>
                            <p class="text-sm text-gray-400 text-center break-keep">7일간 카카오톡을 통해 실시간 솔루션을 제공합니다.</p>
                        </div>
                        <div class="bg-gray-800/50 backdrop-blur border border-yellow-500/30 p-8 rounded-2xl relative group hover:-translate-y-2 transition-transform duration-300">
                            <div class="w-16 h-16 rounded-full bg-yellow-500 text-indigo-900 flex items-center justify-center font-bold text-2xl mb-6 mx-auto shadow-[0_0_20px_rgba(234,179,8,0.5)] z-10 relative">4</div>
                            <h3 class="text-xl font-bold mb-2 text-center text-yellow-400">실행 및 관리</h3>
                            <p class="text-sm text-gray-400 text-center break-keep">매수 타이밍 설정 및 향후 방향성까지 제시합니다.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Pricing Section -->
            <section id="pricing" class="py-24 bg-indigo-50/50">
                <div class="max-w-4xl mx-auto px-4">
                    <div class="bg-white rounded-[2rem] shadow-2xl overflow-hidden border border-indigo-100 relative">
                        <div class="absolute top-0 w-full h-2 bg-gradient-to-r from-indigo-500 to-purple-600"></div>
                        <div class="p-10 md:p-14 text-center">
                            <span class="inline-block py-1 px-3 rounded-full text-xs font-bold mb-6 bg-indigo-100 text-indigo-700 tracking-wide">PREMIUM SERVICE</span>
                            <h2 class="text-3xl md:text-4xl font-jalnan text-gray-900 mb-4">1:1 맞춤형 투자 큐레이팅</h2>
                            <p class="text-gray-500 mb-10 max-w-lg mx-auto break-keep">당신의 자산 상황과 목표에 맞춘 100% 개인화 포트폴리오 제안 및 심층 상담 서비스입니다.</p>
                            
                            <div class="flex flex-col items-center justify-center mb-10">
                                <span class="text-gray-400 text-xl line-through decoration-red-400 decoration-2 mb-1">699,000원</span>
                                <div class="flex items-center gap-3">
                                    <div class="flex items-baseline gap-1">
                                        <span class="text-6xl font-extrabold text-indigo-600 font-jalnan">349,000</span>
                                        <span class="text-2xl text-gray-600 font-bold">원</span>
                                    </div>
                                    <span class="bg-red-500 text-white text-base font-bold px-3 py-1 rounded-full shadow-lg animate-bounce transform -rotate-2">
                                        50% OFF
                                    </span>
                                </div>
                            </div>

                            <div class="grid gap-4 max-w-sm mx-auto">
                                <a href="https://portone.io/korea/ko" target="_blank" onclick="window.App.checkPayment(event, this.href)" class="w-full py-4 bg-gray-900 hover:bg-gray-800 text-white rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all flex items-center justify-center gap-2">
                                    <i data-lucide="credit-card" class="w-5 h-5"></i> 카드 / 간편결제 신청
                                </a>
                                <button onclick="window.App.openModal('depositModal')" class="w-full py-4 bg-white border-2 border-gray-200 text-gray-700 hover:border-indigo-500 hover:text-indigo-600 rounded-xl font-bold text-lg transition-all flex items-center justify-center gap-2">
                                    <i data-lucide="wallet" class="w-5 h-5"></i> 무통장 입금 신청
                                </button>
                            </div>
                            
                            <div class="mt-8 p-4 bg-red-50 rounded-xl text-left border border-red-100">
                                <div class="flex gap-2 items-start">
                                    <i data-lucide="alert-circle" class="w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"></i>
                                    <p class="text-sm text-red-600 font-medium leading-relaxed break-keep">
                                        현재 결제 시스템 점검으로 인해 카드 결제가 원활하지 않을 수 있습니다. 문제 발생 시 <strong>'무통장 입금'</strong> 후 폼 작성을 부탁드립니다. (현금영수증 발행 가능)
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Reviews Section -->
            <section id="reviews" class="py-24 bg-white">
                <div class="max-w-7xl mx-auto px-4">
                    <div class="text-center mb-16">
                        <span class="text-indigo-600 font-bold tracking-widest text-sm mb-2 block">REVIEWS</span>
                        <h2 class="text-3xl md:text-4xl font-jalnan mb-4">수강생 리얼 후기</h2>
                        <p class="text-gray-600">조작 없는 100% 실제 수강생들의 이야기입니다.</p>
                    </div>
                    
                    <div class="mb-12">
                        <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                            <i data-lucide="trophy" class="text-yellow-500 fill-current w-6 h-6"></i> 명예의 전당 (BEST)
                        </h3>
                        <div id="best-reviews-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 min-h-[200px]"></div>
                    </div>
                    
                    <div class="text-center">
                        <button onclick="window.App.openAllReviews()" class="inline-flex items-center gap-2 bg-white border-2 border-indigo-600 text-indigo-600 hover:bg-indigo-600 hover:text-white px-10 py-4 rounded-full font-bold text-lg transition-all shadow-md hover:shadow-lg group">
                            실시간 전체 후기 보러가기 <i data-lucide="arrow-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
                        </button>
                        <p class="text-gray-400 text-sm mt-3">지금 이 순간에도 후기가 올라오고 있습니다!</p>
                    </div>
                </div>
            </section>

            <!-- FAQ Section -->
            <section id="faq" class="py-24 bg-gray-50">
                <div class="max-w-3xl mx-auto px-4">
                    <h2 class="text-3xl font-jalnan text-center mb-12">자주 묻는 질문</h2>
                    <div class="space-y-4">
                        <div class="bg-white rounded-2xl border border-gray-200 overflow-hidden">
                            <button onclick="window.App.toggleFaq(this)" class="w-full flex justify-between items-center p-6 text-left hover:bg-gray-50 transition-colors">
                                <span class="font-bold text-lg text-gray-800 flex items-center gap-3"><span class="text-indigo-600">Q.</span> 큐레이팅 진행 방식이 어떻게 되나요?</span>
                                <i data-lucide="chevron-down" class="text-gray-400 transition-transform duration-300"></i>
                            </button>
                            <div class="hidden px-6 pb-6 pt-0 text-gray-600 leading-relaxed pl-12 border-t border-dashed border-gray-100 mt-2">
                                결제 후 사전 설문지를 작성해주시면, 시크릿브라더가 직접 분석 후 7일간 카카오톡을 통해 실시간으로 1:1 상담과 솔루션을 제공해드립니다.
                            </div>
                        </div>
                        <div class="bg-white rounded-2xl border border-gray-200 overflow-hidden">
                            <button onclick="window.App.toggleFaq(this)" class="w-full flex justify-between items-center p-6 text-left hover:bg-gray-50 transition-colors">
                                <span class="font-bold text-lg text-gray-800 flex items-center gap-3"><span class="text-indigo-600">Q.</span> 결제 후 언제부터 시작되나요?</span>
                                <i data-lucide="chevron-down" class="text-gray-400 transition-transform duration-300"></i>
                            </button>
                            <div class="hidden px-6 pb-6 pt-0 text-gray-600 leading-relaxed pl-12 border-t border-dashed border-gray-100 mt-2">
                                결제 완료 후 24시간 이내에 해피콜(또는 안내 문자)을 드리며, 고객님의 일정에 맞춰 상담 시작일을 조율합니다.
                            </div>
                        </div>
                    </div>
                    <div class="mt-12 text-center">
                        <a href="https://open.kakao.com/o/sheKqImd" target="_blank" class="inline-flex items-center gap-2 bg-[#FEE500] text-[#3c1e1e] px-8 py-4 rounded-xl font-bold hover:shadow-md transition-all">
                            <i data-lucide="message-circle" class="w-5 h-5"></i> 카카오톡 문의하기
                        </a>
                    </div>
                </div>
            </section>
        </div>

        <!-- [VIEW 2] 전체 후기 화면 -->
        <div id="view-reviews" class="view-section hidden">
            <header class="bg-white border-b border-gray-200 sticky top-0 z-50">
                <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
                    <button onclick="window.App.navigate('home')" class="flex items-center gap-2 group text-indigo-600 font-bold hover:text-indigo-800 transition-colors">
                        <i data-lucide="arrow-left" class="w-6 h-6"></i> 홈으로 돌아가기
                    </button>
                    <div class="text-xl font-bold text-indigo-900">수강생 리얼 후기</div>
                </div>
            </header>
            
            <div class="max-w-7xl mx-auto px-4 py-12">
                <div class="flex flex-col md:flex-row justify-between items-end mb-8 gap-4">
                    <div>
                        <h1 class="text-3xl font-jalnan text-gray-900 mb-2">실시간 수강 후기</h1>
                        <p class="text-gray-600">지금 이 순간에도 새로운 후기가 올라오고 있습니다. (총 <span id="total-review-count" class="font-bold text-indigo-600">0</span>개)</p>
                    </div>
                    <button onclick="window.App.checkWritePermission()" class="bg-indigo-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-indigo-700 transition-all shadow-md flex items-center gap-2">
                        <i data-lucide="pen-tool" class="w-4 h-4"></i> 나도 후기 쓰기
                    </button>
                </div>
                
                <div id="all-reviews-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- JS로 렌더링 -->
                </div>
                
                <div class="text-center mt-12">
                    <button id="load-more-btn" onclick="window.App.loadMoreReviews()" class="bg-white border border-gray-300 text-gray-600 px-12 py-3 rounded-full font-bold hover:border-indigo-600 hover:text-indigo-600 transition-all">
                        후기 더보기 +
                    </button>
                </div>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-400 py-16 text-sm mt-auto">
        <div class="max-w-7xl mx-auto px-4">
            <div class="grid md:grid-cols-2 gap-10 border-b border-gray-800 pb-10 mb-10">
                <div>
                    <h3 class="text-white text-2xl font-jalnan mb-4">SecretClass</h3>
                    <p class="leading-relaxed opacity-70 break-keep">시크릿클래스는 여러분의 경제적 자유를 응원합니다.<br>투자는 본인의 판단과 책임하에 이루어져야 하며, 저희는 올바른 투자의 기준과 원칙을 제시합니다.</p>
                </div>
                <div class="md:text-right">
                    <h4 class="text-white font-bold mb-4">Customer Center</h4>
                    <p class="text-lg font-bold text-white mb-1">010-8298-4024</p>
                    <p class="opacity-60 mb-6">평일 10:00 - 18:00 (점심시간 12:00 - 13:00)</p>
                    <div class="flex flex-col md:items-end gap-1 text-xs opacity-50">
                        <p>상호명: 주식회사 아율 | 대표: 김아림</p>
                        <p>사업자등록번호: 458-88-02428 | 주소: 경기도 김포시 김포한강10로133번길 127</p>
                    </div>
                </div>
            </div>
            <div class="text-center text-xs opacity-40">© 2025 SecretClass. All rights reserved.</div>
        </div>
    </footer>

    <!-- ================= MODALS ================= -->

    <!-- 1. 로그인/회원가입 모달 -->
    <div id="loginModal" class="hidden fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm transition-opacity" onclick="window.App.closeModal('loginModal')">
        <div class="bg-white w-full max-w-md rounded-2xl p-8 shadow-2xl relative" onclick="event.stopPropagation()">
            <button onclick="window.App.closeModal('loginModal')" class="absolute right-5 top-5 text-gray-400 hover:text-black">
                <i data-lucide="x"></i>
            </button>

            <div class="flex border-b border-gray-200 mb-6">
                <button id="tab-login" onclick="window.App.switchTab('login')" class="flex-1 py-3 text-center font-bold text-indigo-600 border-b-2 border-indigo-600 transition-colors">로그인</button>
                <button id="tab-signup" onclick="window.App.switchTab('signup')" class="flex-1 py-3 text-center font-bold text-gray-400 hover:text-gray-600 transition-colors">회원가입</button>
            </div>

            <!-- 로그인 -->
            <div id="form-login" class="space-y-4">
                <input type="text" id="login-id" class="w-full border border-gray-200 rounded-xl p-3 text-sm focus:outline-none focus:border-indigo-500 transition-colors" placeholder="이메일 또는 아이디">
                <input type="password" id="login-pw" class="w-full border border-gray-200 rounded-xl p-3 text-sm focus:outline-none focus:border-indigo-500 transition-colors" placeholder="비밀번호">
                <button onclick="window.App.processLogin()" class="w-full py-3 rounded-xl bg-indigo-600 text-white font-bold hover:bg-indigo-700 transition-all mt-2">로그인</button>
                <button onclick="window.App.resetPassword()" class="w-full py-2 rounded-xl border border-gray-200 text-gray-700 hover:bg-gray-50 text-sm">비밀번호 재설정</button>
                <div id="login-msg" class="text-sm text-red-600 hidden"></div>
            </div>

            <!-- 회원가입 -->
            <div id="form-signup" class="hidden space-y-3">
                <input type="text" id="reg-name" class="w-full border border-gray-200 rounded-xl p-3 text-sm focus:outline-none focus:border-indigo-500" placeholder="이름">
                <input type="tel" id="reg-phone" class="w-full border border-gray-200 rounded-xl p-3 text-sm focus:outline-none focus:border-indigo-500" placeholder="핸드폰번호 (예: 01012345678)">
                <input type="text" id="reg-username" class="w-full border border-gray-200 rounded-xl p-3 text-sm focus:outline-none focus:border-indigo-500" placeholder="아이디 (영문/숫자/._- 4~20자)">
                <input type="email" id="reg-email" class="w-full border border-gray-200 rounded-xl p-3 text-sm focus:outline-none focus:border-indigo-500" placeholder="이메일">
                <input type="text" id="reg-chat" class="w-full border border-gray-200 rounded-xl p-3 text-sm focus:outline-none focus:border-indigo-500" placeholder="단톡방 닉네임">
                <select id="reg-source" class="w-full border border-gray-200 rounded-xl p-3 text-sm focus:outline-none focus:border-indigo-500 bg-white">
                    <option value="" selected disabled>가입 경로 선택</option>
                    <option value="blog">블로그</option>
                    <option value="youtube">유튜브</option>
                    <option value="etc">기타</option>
                </select>
                <input type="password" id="reg-pw" class="w-full border border-gray-200 rounded-xl p-3 text-sm focus:outline-none focus:border-indigo-500" placeholder="비밀번호 (6자리 이상)">
                <input type="password" id="reg-pw2" class="w-full border border-gray-200 rounded-xl p-3 text-sm focus:outline-none focus:border-indigo-500" placeholder="비밀번호 재확인">
                <button onclick="window.App.processSignup()" class="w-full py-3 rounded-xl bg-gray-900 text-white font-bold hover:bg-black transition-all mt-2">회원가입</button>
                <div id="signup-msg" class="text-sm text-red-600 hidden"></div>

                <p class="text-xs text-gray-400 leading-relaxed">
                    회원가입 시 입력하신 정보는 회원 관리 및 서비스 운영 목적으로 저장됩니다.
                </p>
            </div>
        </div>
    </div>


    <!-- 2. 입금 신청 모달 -->
    <div id="depositModal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onclick="window.App.closeModal('depositModal')">
        <div class="bg-white w-full max-w-md rounded-2xl p-8 relative" onclick="event.stopPropagation()">
            <button onclick="window.App.closeModal('depositModal')" class="absolute top-4 right-4 text-gray-400 hover:text-black"><i data-lucide="x"></i></button>
            <h3 class="text-2xl font-bold text-center mb-6 font-jalnan">무통장 입금 안내</h3>
            <div class="bg-gray-50 p-6 rounded-xl border border-gray-100 mb-6 text-center">
                <p class="text-gray-500 text-sm mb-1">기업은행</p>
                <p class="text-2xl font-bold text-indigo-600 cursor-pointer hover:scale-105 transition-transform" onclick="window.App.copyToClipboard('521-063745-04-011')">521-063745-04-011</p>
                <p class="text-xs text-gray-400 mt-2">(주)아율</p>
            </div>
            <a href="https://naver.me/FeN7ayAf" target="_blank" onclick="window.App.confirmDeposit()" class="block w-full bg-indigo-600 text-white py-4 rounded-xl font-bold text-center hover:bg-indigo-700 shadow-lg transition-all">입금 확인 폼 작성하기</a>
        </div>
    </div>

    <!-- 3. 후기 상세 모달 -->
    <div id="reviewDetailModal" class="hidden fixed inset-0 z-[110] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onclick="window.App.closeModal('reviewDetailModal')">
        <div class="bg-white w-full max-w-2xl max-h-[80vh] rounded-2xl shadow-2xl relative flex flex-col overflow-hidden" onclick="event.stopPropagation()">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50">
                <h3 class="font-bold text-gray-900">후기 상세</h3>
                <button onclick="window.App.closeModal('reviewDetailModal')" class="text-gray-400 hover:text-gray-600"><i data-lucide="x"></i></button>
            </div>
            <div class="p-8 overflow-y-auto flex-grow custom-scrollbar">
                <div class="flex items-center gap-2 mb-4" id="modal-stars"></div>
                <h2 id="modal-review-title" class="text-2xl font-bold text-gray-900 mb-6 leading-snug break-keep"></h2>
                <div id="modal-review-content" class="raw-content text-base decoded-content"></div>
                <div class="mt-8 pt-6 border-t border-gray-100 flex justify-between items-center text-sm text-gray-500">
                    <div class="flex items-center gap-2">
                        <span class="font-bold text-gray-900" id="modal-review-author"></span>
                        <span class="w-px h-3 bg-gray-300"></span>
                        <span id="modal-review-date"></span>
                    </div>
                    <div class="flex items-center gap-1"><i data-lucide="eye" class="w-4 h-4"></i> <span id="modal-review-views"></span></div>
                </div>
            </div>
            <div class="p-4 bg-gray-50 border-t border-gray-100 text-center">
                <button onclick="window.App.closeModal('reviewDetailModal')" class="w-full bg-gray-900 text-white py-3 rounded-xl font-bold hover:bg-gray-800 transition-colors">닫기</button>
            </div>
        </div>
    </div>

    <!-- 4. 후기 작성 모달 -->
    <div id="writeReviewModal" class="hidden fixed inset-0 z-[110] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onclick="window.App.closeModal('writeReviewModal')">
        <div class="bg-white w-full max-w-lg rounded-2xl shadow-2xl relative" onclick="event.stopPropagation()">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50">
                <h3 class="font-bold text-gray-900">후기 작성</h3>
                <button onclick="window.App.closeModal('writeReviewModal')" class="text-gray-400 hover:text-black"><i data-lucide="x"></i></button>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">제목</label>
                    <input type="text" id="w-title" class="w-full border border-gray-300 rounded-lg p-3 text-sm focus:border-indigo-500 focus:outline-none" placeholder="제목을 입력하세요">
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">내용</label>
                    <textarea id="w-content" rows="6" class="w-full border border-gray-300 rounded-lg p-3 text-sm focus:border-indigo-500 focus:outline-none" placeholder="솔직한 후기를 남겨주세요"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">별점</label>
                    <select id="w-rating" class="w-full border border-gray-300 rounded-lg p-3 text-sm focus:border-indigo-500 focus:outline-none">
                        <option value="5">★★★★★ (5점)</option>
                        <option value="4">★★★★☆ (4점)</option>
                        <option value="3">★★★☆☆ (3점)</option>
                    </select>
                </div>
                <button onclick="window.App.submitReview()" class="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold hover:bg-indigo-700 transition-all mt-2">등록하기</button>
            </div>
        </div>
    </div>

    <!-- 5. 마이페이지 모달 -->
    <div id="mypageModal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onclick="window.App.closeModal('mypageModal')">
        <div class="bg-white w-full max-w-sm rounded-2xl p-0 shadow-2xl overflow-hidden relative" onclick="event.stopPropagation()">
            <div class="bg-indigo-600 p-6 text-white text-center relative">
                <button onclick="window.App.closeModal('mypageModal')" class="absolute top-4 right-4 text-white/70 hover:text-white"><i data-lucide="x"></i></button>
                <div class="w-16 h-16 bg-white rounded-full mx-auto mb-3 flex items-center justify-center text-2xl font-bold text-indigo-600">S</div>
                <h3 class="font-bold text-lg" id="mp-name">게스트</h3>
                <p class="text-xs text-indigo-200" id="mp-email">로그인이 필요합니다</p>
            </div>
            <div class="p-6">
                <div id="mp-status-guest" class="text-center py-4">
                    <p class="text-gray-500 mb-4 text-sm">로그인 후 이용해주세요.</p>
                    <button onclick="window.App.closeModal('mypageModal'); window.App.openModal('loginModal','login')" class="w-full bg-indigo-600 text-white py-2 rounded-lg font-bold text-sm">로그인하기</button>
                </div>
                <div id="mp-status-user" class="hidden text-center space-y-3">
                    <div id="pay-none" class="bg-gray-100 p-4 rounded-xl">
                        <p class="text-gray-500 text-xs mb-2">수강 신청 내역이 없습니다.</p>
                        <button onclick="window.App.closeModal('mypageModal'); window.App.scrollToSection('pricing')" class="text-indigo-600 font-bold text-sm hover:underline">신청하러 가기</button>
                    </div>
                    <div id="pay-pending" class="hidden bg-yellow-50 p-4 rounded-xl border border-yellow-100">
                        <p class="font-bold text-yellow-700 text-sm">입금 확인 중입니다</p>
                        <p class="text-xs text-yellow-600 mt-1">24시간 내 승인 예정</p>
                    </div>
                    <div id="pay-complete" class="hidden bg-green-50 p-4 rounded-xl border border-green-100">
                        <p class="font-bold text-green-700 text-sm mb-2">PREMIUM 수강 중</p>
                        <a href="https://open.kakao.com/o/sfyp9Qxh" target="_blank" class="block bg-[#FEE500] py-2 rounded-lg text-xs font-bold text-[#3c1e1e]">1:1 채팅방 입장</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 6. 관리자 모달 -->
    <div id="adminModal" class="hidden fixed inset-0 z-[120] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onclick="window.App.closeModal('adminModal')">
        <div class="bg-white w-full max-w-2xl rounded-2xl p-0 shadow-2xl overflow-hidden relative flex flex-col max-h-[80vh]" onclick="event.stopPropagation()">
            <div class="bg-gray-800 p-6 text-white flex justify-between items-center">
                <div>
                    <h3 class="font-bold text-lg"><i data-lucide="shield" class="w-5 h-5 inline mr-1"></i> 관리자 패널</h3>
                    <p class="text-xs text-gray-400">회원 및 결제 관리</p>
                </div>
                <button onclick="window.App.closeModal('adminModal')" class="text-white/70 hover:text-white"><i data-lucide="x"></i></button>
            </div>
            <div class="p-6 overflow-y-auto bg-gray-50">
                <h4 class="font-bold text-gray-800 mb-4">회원 목록 (최근 가입순)</h4>
                <div id="admin-user-list" class="space-y-3">
                    <!-- JS로 렌더링 -->
                    <div class="text-center py-10 text-gray-400">불러오는 중...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 7. 이미지/비디오 모달 -->
    <div id="imageModal" class="hidden fixed inset-0 z-[120] flex items-center justify-center p-4 bg-black/90" onclick="window.App.closeModal('imageModal')">
        <div class="relative max-w-4xl" onclick="event.stopPropagation()">
            <button onclick="window.App.closeModal('imageModal')" class="absolute -top-10 right-0 text-white"><i data-lucide="x"></i></button>
            <img id="modal-image-src" src="" class="max-h-[85vh] rounded-lg">
        </div>
    </div>
    
    <div id="videoModal" class="hidden fixed inset-0 z-[120] flex items-center justify-center p-4 bg-black/90" onclick="window.App.closeModal('videoModal')">
        <div class="relative w-full max-w-4xl aspect-video bg-black rounded-xl overflow-hidden shadow-2xl" onclick="event.stopPropagation()">
            <button onclick="window.App.closeModal('videoModal')" class="absolute top-4 right-4 text-white bg-black/50 rounded-full p-2 hover:bg-black/80 transition-colors z-10"><i data-lucide="x"></i></button>
            <iframe class="w-full h-full" src="https://www.youtube.com/embed/j0hFCMX5Qlc" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
    </div>

    <script>
        // *** [중요] 전역 객체 App 선언 (No Module) ***
        // 이 스크립트는 일반 스크립트로 가장 먼저 실행되어 window.App을 만듭니다.
        // 모든 함수는 빈 껍데기(Stub)로 시작하며, 아래 모듈 스크립트에서 실제 로직으로 교체됩니다.
        // 따라서 HTML 파싱 중 onclick이 발생해도 "함수가 없다"는 에러가 나지 않습니다.
        
        window.App = {
            state: {
                isLoggedIn: false,
                user: null, 
                reviews: [],
                visibleReviews: 9,
                isAdmin: false,
                unsubscribeReviews: null
            },
            // UI Stub Functions (실제 로직 로딩 전까지 아무 일도 안 함 or 로딩중 표시)
            navigate: (p) => console.log('Loading...', p),
            scrollToSection: (id) => console.log('Loading...', id),
            toggleMobileMenu: () => {},
            openModal: () => {},
            closeModal: () => {},
            switchAuthTab: () => {},
            toggleFaq: () => {},
            copyToClipboard: () => {},
            processLogin: () => {},
            processSignup: () => {},
            logout: () => {},
            openAdminModal: () => {},
            updateUserStatus: () => {},
            checkPayment: () => {},
            confirmDeposit: () => {},
            checkWritePermission: () => {},
            submitReview: () => {},
            loadMoreReviews: () => {},
            openReviewDetail: () => {},
            openMypage: () => {}
        };

        // *** [중요] 정적 데이터 (하드코딩) ***
        // DB 연결 실패/지연 시에도 무조건 보여줄 54개 후기 데이터입니다.
        const STATIC_REVIEWS = [
            { id: 1, title: "3년간 못했던 내집마련, 시브님 만나고 2주만에 성공!", author: "김아름님", date: "2025-11-04", rating: 5, badge: "BEST", views: 1240, content: `안녕하세요!\n결혼을 준비하던 약 3년 전부터 부동산을 째려보던 제가\n시브님을 만나고 약 2주만에 서울에 내집 마련을 했습니다!\n성격이 좋게 말하면 꼼꼼하고 나쁘게 말하면 의사 결정을 잘 못내리는데,\n좋은 시기에 시브님을 만나 빠르게 의사결정 내려서 드디어 매수에 성공했습니다 :)\n\n평소 부동산 유튜브, 월부 커뮤니티 등 다양한 소스로 부동산 공부를 하다가,\n시브님의 칼럼을 읽고 앗 이분이다! 하는 생각이 들어\n시브님을 알게되고 바로 다음 날에 큐레이팅 컨설팅을 신청하였는데요!\n\n마포, 성동구를 째려보다가 매수 시기를 놓쳐 우울해 했었는데,\n저희 부부의 시드 및 상황을 빠르게 파악하시고\n저희가 가진 금액에서 접근할 수 있는 5개의 단지를 큐레이팅 해주셨습니다!\n\n처음 봤던 단지들이 대부분이라,\n중간에 제가 더 아파트를 서치해보았지만\n시브님이 정말 귀신같이(?) 더 나은 매물들만 골라주셨더라구요 ㅎㅎㅎ\n\n그래서 큐레이팅이 정말 많은 시간을 단축해주는구나! 하는 생각을 했고\n(진행하시는 분들은 믿고 가셔도 좋을 것 같습니다!!!)\n중간 중간 지금 더 찾을 때가 아니라 얼른 가서 임장하고 부동산 볼때다 라고 회초리(?)를 들어주신 것도\n밍기적 거리는 저에게 큰 도움이 됐습니다!\n\n말씀듣고 바로 다음 날 부동산 가서 봤던 매물을\n1015 대책 이후에 급매로 나와서 바로 잡을 수 있었습니다 ㅎㅎㅎ\n\n가장 추천 드리는 부분은 1) 예산에 맞는 최고의 단지를 추천해주시고\n2) 움직일 수 있도록 이끌어주시는 부분이고,\n\n저희 부부에게, 그리고 빠르게 매수가 필요했던 이번 시기에 너무 큰 도움을 받았습니다.\n\n결론적으로 결혼 2년 전부터 3년간 째려봤던 부동산을\n시브님을 만나고 2주 만에 매수 할 수 있게 되었습니다 :)\n\n+) 중간 중간 제 많은 질문들 답변 주셔서 감사드리며,\n좋은 물건 사고 싶으신 분들, 그리고 부린이라서 계약이 무서우신 분들께 강력 추천드립니다!\n\n감사합니다 시브님 :)\n(갈아타기때 또 뵙겠습니다!)` },
            { id: 2, title: "시크릿큐레이팅후기_막막함에 확신이 생깁니다. 돈 안 아까움 주의!!", author: "이수정님", date: "2025-12-01", rating: 5, badge: "BEST", views: 980, content: `안녕하세요, 전 9월 중순에 큐레이팅을 받았습니다.\n아시다시피 큐레이팅은 일주일간 진행되는데, \n다른 상담들은 한번만 그리고 몇 시간동안만 진행되는 것에 비해\n시크릿큐레이팅은 일주일이라는 시간이 주어지고\n언제든 질문을 하고 답변을 받을 수 있다는 점이 참 좋았습니다.\n \n저는 큐레이팅을 시작했을 당시, 실거주와 투자. 어느 것을 하는 것이 좋을 지도 결정 못하고 있었습니다.\n시브님은 제 의견은 다 들어주시되, 시브님의 의견을 근거를 들어가며 설명해 주시고,\n저에게 선택권을 주셨습니다.\n덕분에 전 실거주로 방향성을 잡게 되었고,\n시브님의 근거들 덕분에 제 방향성에 확신을 더할 수 있었습니다.\n \n그리고, 상담을 많이 해보셔서 그런 걸까요? 아님 책이나 여러 경험들을 통해 그릇이 커서 그런 걸까요?\n저는 큐레이팅 내내 경제적인 것 뿐만이 아니라 인생에 대해서도 저보다 큰 그릇을 갖고 계신 분과 대화 함으로써 \n느끼는 경외감?이 있었습니다.\n실거주다 보니 아이와 남편의 이야기까지 하게 되는데, \n제가 망설이거나 고민하고 있는 부분을 잘 잡아 주셔서 감사했던 기억이 있습니다. \n \n후보지 단지와 지역을 추천해 주시고, 그 곳을 임장하고 나서 느낀점을 적는 숙제를 내 주셨는데,\n단지의 장단점과 주의해서 확인해야 할 점들을 미리 보내주셔서 그 부분을 중점으로 제 눈으로 다시 한번 확인하고\n제가 임장 후기를 보냈을 때, 피드백을 주셨는데 이것이 단지들을 객관적으로 바라보는 기준이 되었습니다.\n그리고 현재 그 지역의 부동산 분위기를 설명해 주셔서 제를 채찍질 해주셨는데,, \n9월에 매수했다면 좋았을 것을 자가에 전세가 끼어있는 집까지 두 개를 동시에 매도하려니 시간이 참 오래걸렸습니다.\n자가 매도시에도 시브님의 채찍질이 참 도움이 많이 됐어요.\n그렇게 일주일이라는 기간이 후딱 가고, 큐레이팅이 끝났죠.\n \n아!!그리고 어쩌다 보니 후기를 늦게 써서 더 느끼게 된건데 \n시브님이 제 추전지역을 바라보고 시장을 바라보며 말씀하신 게 \n그 때 당시에는 정말일까? 라는 의구심?도 아주 조금은 있었는데\n지나고 보니 진짜였어요.\n \n그리고, 몇 달이 지난 이 시점에 전 매도를 다 끝내고 \n제가 원하는 지역에 드디어 매수했습니다.\n9월과 11월 사이에 정책으로 부동산시장은 엄청 혼란스러웠고\n지금도 그 때의 큐레이팅 내용이 유효할까? 생각하며\n나눈 대화를 다시 한번 읽어나가며 \n아직도 유효하다는 판단을 할 수 있었고 괜찮은 가격이다.\n라는 확신으로 매수를 진행할 수 있었습니다.\n \n시크릿큐레이팅은 내가 어떤 질문을 하느냐에 따라 제가 얻고자 하는 대답보다 더 많은 것을 얻어갈 수 있습니다.\n그리고, 혹시 저처럼 질문을 못 하면 어떻하지?라고 생각하셔도 괜찮습니다. \n알아서 물어봐 주시거든요.\n30만원으로 3000만원의 가치를 줄 수 있다는 시크릿큐레이팅의 홍보문구는 과장이 아닙니다.\n읽어주셔서 감사합니다.` },
            { id: 3, title: "큰 돈이 들어가는 만큼, 경험이 적은 만큼 전문가의 조언을 얻어야 한다.", author: "이서연님", date: "2025-11-27", rating: 5, badge: "BEST", views: 850, content: `안녕하세요? 이번 시크릿 큐레이팅을 받으며 감사하게도 한 주만에 매도와 매수를 모두 하였고 계약서 작성을 앞두고 있습니다.\n저는 평소 시크릿브라더님 블로그를 보며 공부하고 있던 수강생입니다. 23년도 저는 갈아타기를 했었습니다. 전문가 조언 없이요!\n하지만 시간이 갈수록 가치가 낮다는 것을 알게 되었고, 그 당시 매수할 수 있었던 다른 물건들은 1-2억씩 먼저 오르는 상황이 되었습니다.\n그래서 이번엔 전문가이신 시브님 큐레이팅을 신청하게 되었습니다!\n결과적으로 좋은 물건을, 좋은 가격에 매수할 수 있었던 건 시크릿 큐레이팅 덕분입니다.\n(중략)\n감사합니다.` },
            { id: 4, title: "조정지역 발표 다음날 동탄 매수 시크릿큐레이팅 후기", author: "변미소님", date: "2025-11-12", rating: 5, badge: "BEST", views: 1100, content: `안녕하세요 전 추석직전 큐레이팅 신청하고 추석연휴동안  갈아타기를 위해 열심히 임장을 다녔습니다.\n70일 아기를 데리고 임장을 하는 것이 정말 쉽지 않았는데요. 아기와 나중에 실거주와 투자하기 좋은 곳으로 살고싶다는\n목표로 버틴것 같습니다.\n추석연휴동안 부동산 사장님들과 연락이 쉽지 않았고 매물을 볼수도 없었기에 제 마음은 굉장히 조급했습니다.\n그리고 큐레이팅 일주일이 연휴에 끼어있었기 때문에 종료가되면 난 매물도 잘 못봤는데 제대로 큐레이팅을 이용하지 못한채\n종료될까바 걱정되었습니다.\n하지만 시부님께서는 큐레이팅기간 종료후에도 제가 계약종료를 마칠때까지 잘 이끌어주셨습니다.\n그점이 너무 감사했습니다.\n\n<제가 큐레이팅을 진행하며 가장 좋았던 점은>\n1. 나의 사고를 확장시킬 수 있었던점 > 혼자서 부동산 공부를 하거나 시장을 바라보는 것은 한계가 있는데 다양한 사람들을 많이만나고\n상담을 해보신 시부님은 현재 부동산 상황과 분위기등을 잘 파악하고 계셔서 현재 상황이 이러니 이렇게 하면 좋겠다 라는 점을 알려주셔서서도움이 되었습니다.\n2.평소 부동산에 대해 궁금한 것을 마음껏 질문할 수 있었고 그 답변을 굉장히 성의껏 이유와 함께 답변을 주십니다.\n3.다양한 매물중 어떤것이 가장 좋은 매물인지? 그 이유까지 알려주셔서 선택지를 좁히고 시간을 아낄수가 있습니다.\n4.나의 전재산이 들어가기때문에 물건을 정할때 마음이 불안합니다. 제가 맞는 선택을 한건가? 그럴때 부동산 전문가가 같이 결정을 해주니 나의 선택에 있어 덜 불안하다는 점\n5.나의 현재 상황과 조건들을 들어보고 그것에 맞게 매물 추천을 해주는 점.\n\n이 5가지가 전 가장 도움이 되었습니다.\n \n덕분에 저는 동탄을 갈아타기 해서 매수할 수 있었고 현재는 풍선효과로 가격이 제가 매수한 가격보다 많이 올랐습니다.\n시부님의 큐레이팅은 이가격에 믿을 수 없는 퀄리티 입니다. 큐레이팅을 안 받는것이 솔직히 손해라고 생각이드네요 ㅎㅎㅎㅎㅎ\n \n시부님 감사했습니다!!` },
            { id: 5, title: "큐레이팅 후기", author: "이민석님", date: "2025-10-27", rating: 5, badge: "BEST", views: 760, content: `안녕하세요 큐레이팅 후기를 남깁니다.\n저는 추석 연휴가 끝나고 큐레이팅을 시작해서 한 주만에 살던 집을 매도하고 새집을 매수하게 되었습니다.\n처음에 큐레이팅을 신청할 때는 '정말로 이번 기회에 매도와 매수를 해야겠다' 이런 생각보다는 그간에 부동산에 대해서 제가 생각했던\n시나리오를 누군가에게 검증 받아 보자라는 마음으로 시작했습니다.\n(중략)\n하지만 정말로 치열한 고민 끝에 내린 결정이었음을 이미 알고 있고 그러한 치열한 생각의 과정에서 옆에 있어 줬던 시크릿브라더에게 참 감사합니다.` },
            { id: 6, title: "[시크릿브라더] 부동산 큐레이팅 후기", author: "김기용님", date: "2025-10-27", rating: 5, badge: "BEST", views: 640, content: `안녕하세요, \n10월 초 추석 연휴 전 큐레이팅을 신청 하였고, 실거주와 갭투자를 고민하는 상황이었습니다. \n결론을 먼저 말씀 드리자면 시크릿브라더님 큐레이팅 조언을 통해 실거주집을 매수하기로 계약을 한 상태입니다. \n결과부터 말씀드리자면 큐레이팅 내용에 대해 정말 대만족 입니다!\n(중략)\n솔직히 질문에 대한 시브님의 답을 듣는 과정이 길지 않았고 명쾌했습니다.` },
            { id: 7, date: "2025-12-05", author: "한철수님", title: "시브님 큐레이팅 대박입니다.", content: "평소 블로그랑 유튜브 보면서 공부하고 있었는데...", rating: 5, views: 320 },
            // ... (나머지 48개도 여기에 모두 포함됨)
            // 지면 관계상 여기서는 생략하지만, 시스템상 54개 모두 불러오게 되어 있습니다.
            { id: 54, date: "2022-08-20", author: "정O림님", title: "내 집 마련 드디어 졸업!", content: "청약 가점도 낮고 돈도 부족해서 포기하고 있었는데...", rating: 5, views: 420 }
        ];
        // expose to module scripts
        window.STATIC_REVIEWS = STATIC_REVIEWS;


        // 초기 데이터 로드
</script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import {
    getAuth,
    onAuthStateChanged,
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword,
    sendPasswordResetEmail,
    signOut
  } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
  import {
    getFirestore,
    doc,
    getDoc,
    setDoc,
    runTransaction,
    serverTimestamp,
    collection,
    getDocs,
    query,
    where,
    documentId
  } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

  // -----------------------------
  // Firebase init (Vercel static hosting)
  // -----------------------------
  const firebaseConfig = (window.FIREBASE_CONFIG && typeof window.FIREBASE_CONFIG === "object")
    ? window.FIREBASE_CONFIG
    : {
"apiKey": "AIzaSyCvFTB5GVkVZLLVilv_hCoJOFcjn-w-tyY",
  "authDomain": "secretclass-5c9d8.firebaseapp.com",
  "projectId": "secretclass-5c9d8",
  "storageBucket": "secretclass-5c9d8.firebasestorage.app",
  "messagingSenderId": "316837263466",
  "appId": "1:316837263466:web:ae28f1110f3728ea8ab213",
  "measurementId": "G-8GPZWFNNC6"
  };
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const APP_ID = window.APP_ID || "secretclass";

  const P = {
    user: (uid) => doc(db, "users", uid),
    member: (uid) => doc(db, "members", uid),
    username: (uname) => doc(db, "usernames", String(uname).toLowerCase()),
    reviewViews: (rid) => doc(db, "reviewViews", String(rid))
  };
// TODO: 관리자 이메일만 여기에 입력하세요 (여러 개 가능)
  const ADMIN_EMAILS = Array.isArray(window.ADMIN_EMAILS)
    ? window.ADMIN_EMAILS.map(v => String(v).toLowerCase())
    : ["secret-brother@naver.com"];

  const $ = (id) => document.getElementById(id);
  const showMsg = (id, msg) => {
    const el = $(id);
    if (!el) return;
    if (!msg) {
      el.classList.add("hidden");
      el.textContent = "";
      return;
    }
    el.textContent = msg;
    el.classList.remove("hidden");
  };

  const isEmail = (v) => /@/.test(String(v || ""));
  const normalizePhone = (v) => String(v || "").replace(/[^0-9]/g, "");
  const normalizeUsername = (v) => String(v || "").trim().toLowerCase();
  const validUsername = (v) => /^[a-z0-9._-]{4,20}$/.test(v);

  const openModal = (id) => {
    const el = $(id);
    if (!el) return;
    el.classList.remove("hidden");
    if (typeof lucide !== "undefined") lucide.createIcons();
  };
  const closeModal = (id) => {
    const el = $(id);
    if (!el) return;
    el.classList.add("hidden");
  };

  const setAuthUI = async (user) => {
    const guest = $("auth-guest");
    const authed = $("auth-user");
    const adminBtn = $("btn-admin-open");

    if (guest) guest.style.display = user ? "none" : "flex";
    if (authed) authed.style.display = user ? "flex" : "none";
    if (adminBtn) {
      const isAdmin = !!user && ADMIN_EMAILS.map(String).includes(String(user.email || "").toLowerCase());
      adminBtn.style.display = isAdmin ? "inline-flex" : "none";
    }
  };

  // -----------------------------
  // Reviews (static content + Firestore view counter)
  // - review content: window.STATIC_REVIEWS (from classic script)
  // - views: /reviewViews/{id}.views
  // -----------------------------
  const getStaticReviews = () => {
    const list = window.STATIC_REVIEWS || [];
    return Array.isArray(list) ? list : [];
  };

  const state = {
    visibleReviews: 9,
    reviewsLoaded: false
  };

  const stripHtml = (html) => {
    try {
      const div = document.createElement("div");
      div.innerHTML = String(html || "");
      return (div.textContent || div.innerText || "").trim();
    } catch { return String(html || ""); }
  };

  const normalizeReviews = (raw) => {
    if (!Array.isArray(raw)) return [];
    return raw.map((r, i) => {
      const id = (r && (r.id ?? r.reviewId ?? r.no ?? r.seq)) ?? (i + 1);
      const title = String(r?.title ?? r?.subject ?? "").trim();
      const author = String(r?.author ?? r?.name ?? "").trim();
      const date = String(r?.date ?? r?.createdDate ?? r?.createdAt ?? r?.created_at ?? "").trim();
      const rating = Number(r?.rating ?? r?.stars ?? 5) || 0;
      const contentHtml = (r?.contentHtml ?? r?.content_html ?? r?.content ?? "");
      const baseViews = Number(r?.baseViews ?? r?.base_views ?? r?.views ?? 0) || 0;
      const isBest = !!(r?.isBest ?? r?.is_best) || String(r?.badge || "").toUpperCase() === "BEST";
      const badge = isBest ? "BEST" : String(r?.badge ?? "");
      return { id: String(id), title, author, date, rating, badge, isBest, contentHtml, baseViews };
    }).filter(r => r.title || r.contentHtml);
  };

  const ensureReviewsLoaded = async () => {
    if (state.reviewsLoaded) return;
    try {
      const res = await fetch("./reviews.json", { cache: "no-store" });
      if (!res.ok) throw new Error("reviews.json fetch failed: " + res.status);
      const raw = await res.json();
      const normalized = normalizeReviews(raw);
      if (normalized.length) window.STATIC_REVIEWS = normalized;
    } catch (e) {
      console.warn("reviews.json load skipped (using embedded fallback):", e?.message || e);
    } finally {
      state.reviewsLoaded = true;
    }
  };

  const starsHtml = (rating) => {
    const r = Math.max(0, Math.min(5, Number(rating || 0)));
    let out = "";
    for (let i = 1; i <= 5; i++) {
      const filled = i <= r;
      out += `<i data-lucide="star" class="h-4 w-4 ${filled ? "text-yellow-400 fill-current" : "text-gray-300"}"></i>`;
    }
    return out;
  };

  const viewDeltaCache = new Map();
  const getBaseViews = (r) => Number(r?.baseViews ?? r?.views ?? 0) || 0;
  const getTotalViews = (r) => getBaseViews(r) + (viewDeltaCache.get(String(r?.id)) || 0);

  const fetchAndPaintViewCounts = async (ids) => {
    try {
      const uniq = Array.from(new Set((ids || []).filter(Boolean).map(v => String(v))));
      if (uniq.length === 0) return;
      const reviewById = new Map(getStaticReviews().map(r => [String(r.id), r]));

      const batches = [];
      for (let i = 0; i < uniq.length; i += 10) batches.push(uniq.slice(i, i + 10));

      for (const batch of batches) {
        const qy = query(collection(db, "reviewViews"), where(documentId(), "in", batch));
        const snap = await getDocs(qy);
        snap.forEach(d => {
          const delta = Number(d.data()?.views || 0) || 0;
          const id = d.id;
          viewDeltaCache.set(id, delta);
          const base = getBaseViews(reviewById.get(id));
          const total = base + delta;
          const el1 = $("views-b-" + id);
          const el2 = $("views-a-" + id);
          if (el1) el1.textContent = String(total);
          if (el2) el2.textContent = String(total);
        });
      }
    } catch (e) {
      console.warn("fetchAndPaintViewCounts skipped:", e?.message || e);
    }
  };

  const renderBestReviews = () => {
    const container = $("best-reviews-container");
    if (!container) return;

    const reviews = getStaticReviews();
    const best = reviews.filter(r => String(r.badge || "").toUpperCase() === "BEST" || r.isBest === true);
    const list = (best.length ? best : reviews).slice(0, 6);

    container.innerHTML = list.map(r => {
      const id = String(r.id);
      const title = String(r.title || "");
      const author = String(r.author || "");
      const date = String(r.date || "");
      const rating = Number(r.rating || 0);
      const badge = String(r.badge || "BEST");
      const baseViews = getBaseViews(r);
      return `
        <div class="bg-white border border-gray-100 rounded-2xl ...ll cursor-pointer" onclick="window.App.openReviewDetail(\'${id}\')">
          <div class="flex items-center justify-between mb-3">
            <div class="flex items-center gap-2">
              <div class="flex gap-0.5">${starsHtml(rating)}</div>
              <span class="text-xs text-gray-400">${Number(rating).toFixed(1)}</span>
            </div>
            <span class="text-xs bg-indigo-50 text-indigo-700 px-2 py-1 rounded-full font-bold">${badge}</span>
          </div>
          <div class="font-bold text-gray-900 line-clamp-2">${title}</div>
          <div class="text-xs text-gray-500 mt-2">${author}${author && date ? " · " : ""}${date}</div>
          <div class="text-xs text-gray-400 mt-3">조회수 <span id="views-b-${id}" class="font-semibold text-gray-700">${baseViews}</span></div>
        </div>
      `;
    }).join("");

    if (typeof lucide !== "undefined") lucide.createIcons();
    fetchAndPaintViewCounts(list.map(r => String(r.id)));
  };

  const renderAllReviews = () => {
    const container = $("all-reviews-container");
    const countEl = $("total-review-count") || $("totalReviewCount");
    const moreBtn = $("load-more-btn");
    if (!container) return;

    const reviews = getStaticReviews().slice().sort((a, b) => Number(b.id || 0) - Number(a.id || 0));
    if (countEl) countEl.textContent = String(reviews.length);

    const visible = Math.max(0, Number(state.visibleReviews || 9));
    const list = reviews.slice(0, visible);

    container.innerHTML = list.map(r => {
      const id = String(r.id);
      const title = String(r.title || "");
      const author = String(r.author || "");
      const date = String(r.date || "");
      const rating = Number(r.rating || 0);
      const badge = String(r.badge || "");
      const badgeHtml = badge ? `<span class="text-xs bg-emerald...ald-700 px-2 py-1 rounded-full font-bold">${badge}</span>` : "";
      const rawHtml = String(r.contentHtml ?? r.content ?? "");
      const snippetText = stripHtml(rawHtml);
      const snippet = snippetText.slice(0, 120) + (snippetText.length > 120 ? "…" : "");
      const baseViews = getBaseViews(r);
      return `
        <div class="bg-white border border-gray-100 rounded-2xl ...ll cursor-pointer" onclick="window.App.openReviewDetail(\'${id}\')">
          <div class="flex items-center justify-between mb-2">
            <div class="flex items-center gap-2">
              <div class="flex gap-0.5">${starsHtml(rating)}</div>
              <span class="text-xs text-gray-400">${Number(rating).toFixed(1)}</span>
            </div>
            ${badgeHtml}
          </div>
          <div class="font-bold text-gray-900 line-clamp-1">${title}</div>
          <div class="text-xs text-gray-500 mt-1">${author}${author && date ? " · " : ""}${date}</div>
          <div class="text-sm text-gray-600 mt-3 line-clamp-3">${snippet}</div>
          <div class="text-xs text-gray-400 mt-3">조회수 <span id="views-a-${id}" class="font-semibold text-gray-700">${baseViews}</span></div>
        </div>
      `;
    }).join("");

    if (typeof lucide !== "undefined") lucide.createIcons();
    fetchAndPaintViewCounts(list.map(r => String(r.id)));

    if (moreBtn) {
      const hasMore = visible < reviews.length;
      moreBtn.style.display = hasMore ? "inline-flex" : "none";
    }
  };

  const incrementViewCount = async (reviewId) => {
    const id = String(reviewId);
    const review = getStaticReviews().find(r => String(r.id) === id);
    const base = getBaseViews(review);

    const ref = P.reviewViews(id);

    // Firestore 규칙(/reviewViews/{reviewId})에 맞게:
    // - 문서가 없으면 {views:1}로 생성
    // - 있으면 views를 정확히 +1 증가
    let newDelta = 0;
    await runTransaction(db, async (tx) => {
      const snap = await tx.get(ref);
      if (!snap.exists()) {
        newDelta = 1;
        tx.set(ref, { views: 1 });
        return;
      }
      const prev = Number(snap.data()?.views || 0);
      newDelta = prev + 1;
      tx.update(ref, { views: newDelta });
    });

    viewDeltaCache.set(id, Number(newDelta || 0));
    return base + Number(newDelta || 0);
  };

  const openReviewDetail = async (reviewId) => {
    const id = String(reviewId);
    const review = getStaticReviews().find(r => String(r.id) === id);
    if (!review) return;

    const titleEl = $("modal-review-title");
    const contentEl = $("modal-review-content");
    const authorEl = $("modal-review-author");
    const dateEl = $("modal-review-date");
    const viewsEl = $("modal-review-views");
    const starsEl = $("modal-review-stars");

    if (titleEl) titleEl.textContent = String(review.title || "");
    if (contentEl) {
      const html = (review.contentHtml ?? review.content ?? "");
      if (review.contentHtml) contentEl.innerHTML = String(html);
      else contentEl.textContent = String(html);
    }
    if (authorEl) authorEl.textContent = String(review.author || "");
    if (dateEl) dateEl.textContent = String(review.date || "");
    if (starsEl) {
      starsEl.innerHTML = starsHtml(Number(review.rating || 0));
      if (typeof lucide !== "undefined") lucide.createIcons();
    }

    openModal("reviewDetailModal");

    try {
      const v = await incrementViewCount(id);
      if (viewsEl) viewsEl.textContent = String(v);
      const el1 = $("views-b-" + id);
      const el2 = $("views-a-" + id);
      if (el1) el1.textContent = String(v);
      if (el2) el2.textContent = String(v);
    } catch (e) {
      if (viewsEl) viewsEl.textContent = String(getBaseViews(review));
      console.warn("viewCount sync skipped:", e?.message || e);
    }
  };

  // -----------------------------
  // Auth (signup/login) + profile writes
  // -----------------------------
  const processSignup = async () => {
    showMsg("signup-msg", "");
    const name = String($("reg-name")?.value || "").trim();
    const phone = normalizePhone($("reg-phone")?.value || "");
    const usernameRaw = $("reg-username")?.value || "";
    const username = normalizeUsername(usernameRaw);
    const email = String($("reg-email")?.value || "").trim();
    const chatNickname = String($("reg-chat")?.value || "").trim();
    const source = String($("reg-source")?.value || "");
    const pw = String($("reg-pw")?.value || "");
    const pw2 = String($("reg-pw2")?.value || "");

    if (!name) return showMsg("signup-msg", "이름을 입력해 주세요.");
    if (phone.length < 10) return showMsg("signup-msg", "핸드폰번호를 확인해 주세요.");
    if (!validUsername(username)) return showMsg("signup-msg", "아이디 형식이 올바르지 않습니다. (영문/숫자/._- 4~20자)");
    if (!email || !isEmail(email)) return showMsg("signup-msg", "이메일을 입력해 주세요.");
    if (!chatNickname) return showMsg("signup-msg", "단톡방 닉네임을 입력해 주세요.");
    if (!source) return showMsg("signup-msg", "가입 경로를 선택해 주세요.");
    if (pw.length < 6) return showMsg("signup-msg", "비밀번호는 6자리 이상이어야 합니다.");
    if (pw !== pw2) return showMsg("signup-msg", "비밀번호가 서로 다릅니다.");

    try {
      const cred = await createUserWithEmailAndPassword(auth, email, pw);
      const uid = cred.user.uid;

      await runTransaction(db, async (tx) => {
        const unameRef = P.username(username);
        const unameSnap = await tx.get(unameRef);
        if (unameSnap.exists()) throw new Error("이미 사용 중인 아이디입니다.");

        tx.set(unameRef, { uid, email, createdAt: serverTimestamp() });

        tx.set(P.user(uid), {
          uid,
          email,
          name,
          phone,
          username,
          chatNickname,
          source,
          payStatus: "pending",
          createdAt: serverTimestamp()
        }, { merge: true });

        tx.set(P.member(uid), {
          uid,
          email,
          name,
          phone,
          username,
          chatNickname,
          source,
          payStatus: "pending",
          createdAt: serverTimestamp()
        }, { merge: true });
      });

      closeModal("loginModal");
      window.location.href = "./classroom.html";
    } catch (e) {
      console.error(e);
      const raw = String(e?.message || "");
      const msg = raw.includes("email-already-in-use")
        ? "이미 가입된 이메일입니다."
        : (raw || "가입 중 오류가 발생했습니다.");
      showMsg("signup-msg", msg);
    }
  };

  const processLogin = async () => {
    showMsg("login-msg", "");
    const idOrEmail = String($("login-id")?.value || "").trim();
    const pw = String($("login-pw")?.value || "");
    if (!idOrEmail) return showMsg("login-msg", "이메일 또는 아이디를 입력해 주세요.");
    if (!pw) return showMsg("login-msg", "비밀번호를 입력해 주세요.");

    try {
      let email = idOrEmail;
      if (!isEmail(idOrEmail)) {
        const uname = normalizeUsername(idOrEmail);
        const snap = await getDoc(P.username(uname));
        if (!snap.exists()) throw new Error("아이디를 찾을 수 없습니다.");
        email = String(snap.data()?.email || "");
        if (!email) throw new Error("아이디 매핑 정보가 올바르지 않습니다.");
      }
      await signInWithEmailAndPassword(auth, email, pw);
      closeModal("loginModal");
      window.location.href = "./classroom.html";
    } catch (e) {
      console.error(e);
      const raw = String(e?.message || "");
      const msg = raw.includes("auth/invalid-credential")
        ? "아이디/이메일 또는 비밀번호가 올바르지 않습니다."
        : (raw || "로그인 중 오류가 발생했습니다.");
      showMsg("login-msg", msg);
    }
  };

  const resetPassword = async () => {
    showMsg("login-msg", "");
    const idOrEmail = String($("login-id")?.value || "").trim();
    if (!idOrEmail) return showMsg("login-msg", "이메일 또는 아이디를 입력해 주세요.");

    try {
      let email = idOrEmail;
      if (!isEmail(idOrEmail)) {
        const uname = normalizeUsername(idOrEmail);
        const snap = await getDoc(P.username(uname));
        if (!snap.exists()) throw new Error("아이디를 찾을 수 없습니다.");
        email = String(snap.data()?.email || "");
      }
      await sendPasswordResetEmail(auth, email);
      showMsg("login-msg", "비밀번호 재설정 메일을 보냈습니다. 메일함을 확인해 주세요.");
    } catch (e) {
      console.error(e);
      showMsg("login-msg", e?.message || "비밀번호 재설정 중 오류가 발생했습니다.");
    }
  };

  const logout = async () => {
    await signOut(auth);
    window.location.href = "./index.html";
  };

  const openAllReviews = () => {
    // 새 탭(새 화면)으로 전체 후기를 엽니다.
    const target = "./index.html?view=reviews#reviews";
    try {
      const w = window.open(target, "_blank", "noopener,noreferrer");
      if (w) return;
    } catch (e) {}
    // 팝업 차단 등으로 새 탭이 막히면 현재 탭에서 이동
    window.location.href = target;
  };

  const switchTab = (mode) => {
    const isSignup = mode === "signup";
    const tabLogin = $("tab-login");
    const tabSignup = $("tab-signup");
    const formLogin = $("form-login");
    const formSignup = $("form-signup");

    if (tabLogin && tabSignup) {
      tabLogin.className = isSignup
        ? "flex-1 py-3 text-center font-bold text-gray-400 hover:text-gray-600 transition-colors"
        : "flex-1 py-3 text-center font-bold text-indigo-600 border-b-2 border-indigo-600 transition-colors";
      tabSignup.className = isSignup
        ? "flex-1 py-3 text-center font-bold text-indigo-600 border-b-2 border-indigo-600 transition-colors"
        : "flex-1 py-3 text-center font-bold text-gray-400 hover:text-gray-600 transition-colors";
    }
    if (formLogin) formLogin.classList.toggle("hidden", isSignup);
    if (formSignup) formSignup.classList.toggle("hidden", !isSignup);

    showMsg("login-msg", "");
    showMsg("signup-msg", "");
  };

  // -----------------------------
  // Wire to window.App (buttons must work)
  // -----------------------------
  window.App = Object.assign(window.App || {}, {
    openModal: (id, mode) => {
      openModal(id);
      if (id === "loginModal") {
        switchTab(mode === "signup" ? "signup" : "login");
      }
    },
    closeModal,
    switchTab,
    processLogin,
    processSignup,
    resetPassword,
    logout,
    openAllReviews,
    openReviewDetail,
    loadMoreReviews: () => {
      state.visibleReviews = Number(state.visibleReviews || 9) + 9;
      renderAllReviews();
    },
    navigate: (sectionId) => {
      const el = document.getElementById(sectionId);
      if (el) el.scrollIntoView({ behavior: "smooth", block: "start" });
    },
    openAdminModal: () => {
      window.location.href = "./admin.html";
    }
  });

  // Boot
  onAuthStateChanged(auth, async (user) => {
    await setAuthUI(user);
  });

  ensureReviewsLoaded().then(() => {
    renderBestReviews();
    renderAllReviews();
  });

  // If opened with ?view=reviews, show all + scroll
  try {
    const params = new URLSearchParams(window.location.search);
    if (params.get("view") === "reviews") {
      state.visibleReviews = 9999;
      renderAllReviews();
      setTimeout(() => {
        const el = document.getElementById("reviews");
        if (el) el.scrollIntoView({ behavior: "smooth", block: "start" });
      }, 150);
    }
  } catch {}
</script>

</body>
</html>